---
title: "28andb DSI studio analysis"
author: "Daniela Cossio"
date: "03/13/2023"
output:
   html_document:
    toc: true
    toc_float: true
    toc_depth: 6
    theme: flatly
---

```{r adding libraries,echo=FALSE, results='hide',message=FALSE}
library(ggplot2)
#(plyr)
library(tidyverse)
# library(dplyr)
# library(tidyr)
library(stringr)
library(kableExtra)
# library(data.table)
# library(network)
# library(tidygraph)
# library(ggraph)
# library(igraph)
# library(networkD3)
# library(CINNA)
# library(umap)
# library(plotly)
#library(factoextra)
#library(lsr)
# library(car)
library(ggpubr)
#library(entropy)
#library(ds4psy)
# library(pROC)
#library(devtools)
#library(BRRR)
#library(stats)
#library(afex)
library(knitr)

knitr::opts_chunk$set(warning=FALSE, message=FALSE, echo = FALSE,
                      fig.align = "center")

```

```{r Global Vars, echo=FALSE, results='hide',message=FALSE}

# working directory to data 
estrogen_path <- "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/"
Prog_path <- "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/"
Gest_path <- "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/"
rows2grab <- c("Tract Name", "number of tracts","mean length(mm)","diameter(mm)", "volume(mm^3)")


# REading in subject info for each analysis 
#Estrogen 

Est_subinfo <- read_csv(paste0(estrogen_path,'estr_demo.csv'))
Gest_subinfo <- read_csv(paste0(Gest_path,'gestWeek_info.csv'))
Prog_subinfo <- read_csv(paste0(Prog_path,'prog_scan.csv'))

```

```{css}
h1, h2, h3,h4 {
  text-align: center;
}
```
# Overview

This is the analysis of the relationship between white matter microstructure and hormones across 

pregnancy in one single subject.


##### **Participants**

  * One subject and a total of 25 scans from July 2019 to May 2021. Scans range from baseline to IVF
  
  to post pregnancy. The number of scans in the analyses varies by hormone analysis and time. 
  
  
  
  * 18 scans were preprocessed successfully. 7 scans removed due to issues with the DWI.
  
    * **2019-07-12_ucsb** : No DWI 
    
    * **2019-08-13_ucsb** : DSI Low Quality Outliar 
    
    * **20191025** :  No DWI 
    
    * **LC002_11_12_19**: No DWI
    
    * **LC002_2_7_20** : No DWI
    
    * **20200312_20200312_100001_490000** : Had DWI but i think there was a conversion error because 
    it failed QSIprep.  so I may re try converting to BidSkit and then re preprocessing
    
    * **2019-10-10_uci**: Was missing for a while but had an issue when converting to bidskit.  
    Missing one of the fmaps needed for proper bids and also needed for DSI. I'll try to reconvert 
    this in case it was an error on my end. 

##### **Scan parameters** 
  * Locations from UCSB and UCI

##### **Blood work**
  * Subject was measured for various levels of hormones including estrogen, progesterone, LH, FSH

##### **Exclusions** 
  * Scan 08/13/19 (labeled as sub-003) was excluded 

##### **QSIprep** 
  * Version used
  
##### **DSI Studio : Correlational connectometry **

  * Version and tags used **chen-2022-07-31**
  
  * Parameters 
    * Length = 25
    * Permutation = 10,000
    * pruning 4
    * non normalized QA
    * T threshold: 2.5


# Methods
A diffusion spectrum imaging scheme was used, and a total of 128 diffusion sampling were acquired. The maximum b-value was 4990 s/mm². The in-plane resolution was 1.8 mm. The slice thickness was 1.8 mm. The accuracy of b-table orientation was examined by comparing fiber orientations with those of a population-averaged template (Yeh et al. Neuroimage, 2018). The b-table was flipped by .012fy. The diffusion data were reconstructed in the MNI space using q-space diffeomorphic reconstruction (Yeh et al., Neuroimage, 58(1):91-9, 2011) to obtain the spin distribution function (Yeh et al., IEEE TMI, ;29(9):1626-35, 2010).  A diffusion sampling length ratio of 1.25 was used. The output resolution in diffeomorphic reconstruction was 1.8 mm isotropic. The tensor metrics were calculated using DWI with b-value lower than 1750 s/mm². The quantitative anisotropy was extracted as the local connectome fingerprint (LCF, Yeh et al. PLoS Comput Biol 12(11): e1005203) and used in the connectometry analysis.



##### Analyses {.tabset}
###### Estrogen 
* Total scans: 16
* Total pregnancy scans = 9 
* 2 scans removed due to having no estrogen measurement
  
###### Progesterone
* Total scans: 15
* Total pregnancy scans = 9 
* 3 scans removed due to having no progesterone measurement

###### Gestational
* Total scans: 12
* 6 scans not used since they are post natal scans
    
### Results    
## <span style="color: pink;"> Estrogen </span>  {.tabset .tabset-dropdown}

### Summary 
Diffusion MRI connectometry (Yeh et al. NeuroImage 125 (2016): 162-171) was used to derive the correlational tractography that has QA AD, MD, and RD correlated with Estrogen. A nonparametric Spearman partial correlation was used to derive the correlation, and the effect of Endocrine_Status was removed using a multiple regression model. A total of 16 subjects were included in the analysis. A T-score threshold of 2.5 was assigned and tracked using a deterministic fiber tracking algorithm (Yeh et al. PLoS ONE 8(11): e80713, 2013) to obtain correlational tractography. A seeding region was placed at whole brain (39,49,29). The tracks were filtered by topology-informed pruning (Yeh et al. Neurotherapeutics, 16(1), 52-58, 2019) with 4 iteration(s). A length threshold of 25 voxel distance was used to select tracks. To estimate the false discovery rate, a total of 4000 randomized permutations were applied to the group label to obtain the null distribution of the track length.  
QA was positively correlated with estrogen levels across numerous tracts including corpus callosum and cingulum. DSI found tracts in the cerebellum with AD, RD, and MD were negatively associated with estrogen levels. Suggesting that increased levels of estrogen are associated with better white matter micro structure. When analyzing pregnancy only scans, DSI only found significant results in the QA analysis. QA was positively associated with estrogen levels.

### QA {.tabset}
```{r QA estrogen VAriables ,echo=FALSE, results='hide',message=FALSE}
# ALl weeks 
Est_QA_all_pos <-
  read.csv(paste0(estrogen_path, 'QA/Allwks/pos_stats.csv'), header = FALSE) %>% 
  filter(V1 %in% rows2grab) %>% 
  t() %>% 
  `colnames<-`(rows2grab) %>% 
  `[`(-c(1), ) %>% 
  as.data.frame()

# Pregnancy only
Est_QA_pregnancy_pos <- read.csv(paste0(estrogen_path,'QA/pregnancy/pos_stats_2.csv'), header=FALSE) %>%filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()


#GEtting my variables together for plots

estr_QA_cols <- c("Subjects", as.character(Est_QA_all_pos[,1]))

#reading in my csv with the stats and adding in the subject info 
Est_QA_all_pos_values <-
  read.csv(paste0(estrogen_path, 'QA/Allwks/pos_stats.csv'), header = FALSE) %>%
  filter(str_detect(V1, c("mean_qa"))) %>%
  filter(!str_detect(V1, c("mean_qa_post_norm"))) %>%
  `colnames<-`(estr_cols) %>%
  mutate(estrogen = Est_subinfo$Estrogen) %>% 
  mutate(status = as.factor(Est_subinfo$`Endocrine Status`)) %>% 
  mutate(trimester = factor(Est_subinfo$trimester, levels= c('pre','first','second', 'third', 'post')))

# Reorder for my sanity check 
Est_QA_all_pos_values <- Est_QA_all_pos_values[,c(1,19,20,21,2:18)]
QA_est_gathercols <- colnames(Est_QA_all_pos_values[5:21])

# for some reason things are being read as a a character and it needs to be a numerical value
Est_QA_all_pos_values[5:21] <- apply(Est_QA_all_pos_values[5:21],2, as.numeric) 

## GAther it long for large compiled figure
Est_QA_all_pos_values_long <- gather(Est_QA_all_pos_values, ROI, QA ,gathercols, factor_key = TRUE) %>% select(!(Subjects))


```

#### All weeks 
##### <span style="color: hotpink;"> Positive (FDR= 0.002484) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(Est_QA_all_pos,row.names=F) %>% 
  kable_styling(bootstrap_options = "hover") %>% 
  scroll_box(width = "800px", height = "200px")
```
#####  <span class="text-center" style="color: Teal;"> Negative (FDR= 0.250000)</span> 
No significant Findings

#####  <span class="text-center" style="color: Dark Blue;"> Figures </span> 

![Slice overlay image displaying tracts that had QA positively correlate with Estrogen levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/QA/Allwks/Est_QA_allstages_pos-cor.png)

![Directional glass brain displaying tracts that had QA positively correlated with Estrogen levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/QA/Allwks/Estrogen.t2.length25.pos_corr.jpg)

![Glass brain displaying tracts that had QA positively correlated with Estrogen levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/QA/Allwks/Estrogen.t2.length25.pos_neg.jpg)

#### Pregnancy only
##### <span style="color: hotpink;"> Positive (FDR= 0.043802) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(Est_QA_pregnancy_pos, row.names=F)
```

#####  <span class="text-center" style="color: Teal;"> Negative (FDR= 1.0000)</span> 
No significant Findings


```{r QA large all tracks Raw data box plot}

Est_QA_all_pos_values_long %>% 
    ggplot( aes(x=trimester, y=QA, group=trimester,fill=trimester)) +
    geom_boxplot() +
  facet_wrap(Est_QA_all_pos_values_long$ROI)  + scale_fill_manual(values = c("#CF92BF", "#D1E7E6", "#A8D2C6", "#6AA390","#90A0C9"))+
  theme(
    strip.text.x = element_text(
      size = 5, color = "black", face = "bold.italic"), strip.text.y = element_blank()) + xlab("Trimester") + ylab("QA") +
  theme(axis.title.x = element_text(size = 4),
    axis.text.x = element_text(size = 4),
    axis.text.y = element_blank(),
    axis.title.y = element_blank() ) + theme(legend.position="none")
sam_size <- Est_QA_all_pos_values %>% dplyr::group_by(status)%>%dplyr::summarize(num=n())
```

```{r Looping through all QA pos Estrogen and making plots Specific variables }
figpath <- "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/QA/Allwks/"

for (ROI in gathercols) {
  print(ROI)
  y <- Est_QA_all_pos_values %>%
    ggplot( aes(x=trimester, y=Est_QA_all_pos_values[[ROI]], group=trimester)) +
      geom_boxplot(width=0.5 ,fill= c("#CF92BF", "#D1E7E6", "#A8D2C6", "#6AA390","#90A0C9")) +
      scale_y_binned(n.breaks=10, nice.breaks = TRUE) +
      labs(x= "Trimester", y= " QA", title =paste0(ROI) ) +
      theme(axis.title.x = element_text(vjust=- 4, size = 16),
            axis.title.y = element_text(vjust=8, size = 16), 
            axis.text.x = element_text(size = 12),
            axis.text.y = element_text(size = 12),
            panel.background =element_blank(),
            axis.line = element_line(colour = "black"),  
            plot.margin = margin(1, 2, 1, 1.5, "cm"), 
            plot.title = element_text(hjust = 0.5, vjust = 2, size = 16, face="bold"))
  
   png(file = paste0(figpath,ROI,".png"))
   print(y)
   dev.off()
}
    
```


### MD {.tabset}
```{r MD all scans correlations,echo=FALSE, results='hide',message=FALSE}
Est_MD_allwks_neg <- read.csv(paste0(estrogen_path,'MD/Allwks/neg_stats_2.5.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

estr_MD_cols <- c("Subjects", as.character(Est_MD_allwks_neg[,1]))

# prepping for figs
Est_MD_all_neg_values <-
  read.csv(paste0(estrogen_path, 'MD/Allwks/neg_stats_2.5.csv'), header = FALSE) %>%
  filter(str_detect(V1, c("mean_md"))) %>%
  `colnames<-`(estr_MD_cols) %>%
  mutate(estrogen = Est_subinfo$Estrogen) %>% 
  mutate(status = as.factor(Est_subinfo$`Endocrine Status`)) %>% 
  mutate(trimester = factor(Est_subinfo$trimester, levels= c('pre','first','second', 'third', 'post')))

# Reorder for my sanity check 
Est_MD_all_neg_values <- Est_MD_all_neg_values[,c(1,5:7,2:4)]
MD_est_gathercols <- colnames(Est_MD_all_neg_values[5:7])

# for some reason things are being read as a a character and it needs to be a numerical value
Est_MD_all_neg_values[5:7] <- apply(Est_MD_all_neg_values[5:7],2, as.numeric) 

## GAther it long for large compiled figure
Est_MD_all_neg_values_long <- gather(Est_MD_all_neg_values, ROI, QA ,MD_est_gathercols, factor_key = TRUE) %>% select(!(Subjects))
```

##### <span style="color: hotpink;"> Positive (FDR= 0.205882) </span> 
No significant findings

#####  <span class="text-center" style="color: Teal;"> Negative (FDR= 0.002002)</span> 
```{r, layout="l-body-outset",echo=FALSE, max.height='100px'}
knitr::kable(Est_MD_allwks_neg, row.names=F)
```

#####  <span class="text-center" style="color: Dark Blue;"> Figures  </span> 
![Slice overlay image displaying ROIs with tracts that had MD negatively correlated with Estrogen levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/MD/Allwks/Est_MD_allstages_neg_cor.png)

![Directional glass brain displaying tracts that had MD negatively correlated with Estrogen levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/MD/Allwks/Estrogen.t2.length25.neg_corr.jpg)

![Glass Brain displaying tracts that had MD negatively correlated with Estrogen levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/MD/Allwks/Estrogen.t2.length25.pos_neg.jpg)

#### Pregnancy 
No significant findings 


```{r, MD file loop}
est_MD_figpath <- "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/MD/Allwks/"

for (ROI in MD_est_gathercols) {
  print(ROI)
  y <- Est_MD_all_neg_values %>%
    ggplot( aes(x=trimester, y=Est_MD_all_neg_values[[ROI]], group=trimester)) +
      geom_boxplot(width=0.5 ,fill= c("#CF92BF", "#D1E7E6", "#A8D2C6", "#6AA390","#90A0C9")) +
      scale_y_binned(n.breaks=10, nice.breaks = TRUE) +
      labs(x= "Trimester", y= " MD", title =paste0(ROI) ) +
      theme(axis.title.x = element_text(vjust=- 4, size = 16),
            axis.title.y = element_text(vjust=8, size = 16), 
            axis.text.x = element_text(size = 12),
            axis.text.y = element_text(size = 12),
            panel.background =element_blank(),
            axis.line = element_line(colour = "black"),  
            plot.margin = margin(1, 2, 1, 1.5, "cm"), 
            plot.title = element_text(hjust = 0.5, vjust = 2, size = 16, face="bold"))
  
   png(file = paste0(est_MD_figpath ,ROI,".png"))
   print(y)
   dev.off()
}
```


### AD {.tabset}
```{r AD all scans correlations,echo=FALSE, results='hide',message=FALSE}

Est_AD_allwks_neg <- read.csv(paste0(estrogen_path,'AD/Allwks/neg_stats_2.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

Est_AD_allwks_pos <- read.csv(paste0(estrogen_path,'AD/Allwks/pos_2.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()
```

#### All weeks 
##### <span style="color: hotpink;"> Positive (FDR= 0.058824) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(Est_AD_allwks_pos, row.names=F)
```

#####  <span class="text-center" style="color: Teal;"> Negative (FDR= 0.000125)</span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(Est_AD_allwks_neg, row.names=F)
```

#####  <span class="text-center" style="color: Dark Blue;"> Figures </span> 
![Slice overlay image displaying tracts that had AD negatively correlate with Estrogen levels](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/AD/Allwks/Est_AD_allstages_neg_cor.png)


#### Pregnancy 
No significant findings 

### RD {.tabset}
#### All weeks 
```{r RD all scans correlations,echo=FALSE, results='hide',message=FALSE}
Est_RD_allwks_neg <- read.csv(paste0(estrogen_path,'RD/Allwks/neg_2.5_all.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

Est_RD_allwks_pos <- read.csv(paste0(estrogen_path,'RD/Allwks/pos_2.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

```
##### <span style="color: hotpink;"> Positive (FDR= 0.122222) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(Est_RD_allwks_pos, row.names=F)
```
#####  <span class="text-center" style="color: Teal;"> Negative (FDR= 0.001106)</span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(Est_RD_allwks_neg, row.names=F)
```

#####  <span class="text-center" style="color: Dark Blue;"> Figures </span> 
![Slice overlay image displaying tracts that had AD negatively correlate with Estrogen levels](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/RD/Allwks/Est_RD_allstages_neg_cor.png)

![Glass Brain displaying tracts that had MD positively and negatively correlated with Estrogen levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/RD/Allwks/Est_RD_allstages_pos_neg_glass.png)

#### pregnancy only
No significant findings


## <span style="color: magenta;"> Progesterone </span>  {.tabset .tabset-dropdown}

### Summary 
Diffusion MRI connectometry (Yeh et al. NeuroImage 125 (2016): 162-171) was used to derive the correlational tractography that has qa,MD, RD and AD correlated with Progesterone. A nonparametric Spearman partial correlation was used to derive the correlation, and the effect of Endocrine_Status was removed using a multiple regression model. A total of 15 subjects were included in the analysis. A T-score threshold of 2.5 was assigned and tracked using a deterministic fiber tracking algorithm (Yeh et al. PLoS ONE 8(11): e80713, 2013) to obtain correlational tractography. A seeding region was placed at whole brain (39,49,29) . The tracks were filtered by topology-informed pruning (Yeh et al. Neurotherapeutics, 16(1), 52-58, 2019) with 4 iteration(s). A length threshold of 25 voxel distance was used to select tracks. To estimate the false discovery rate, a total of 4000 randomized permutations were applied to the group label to obtain the null distribution of the track length.  
 
DSI found significant positive and negative correlations between QA and progesterone in various tracts. There were positive and negative correlations between progesterone and AD, RD, and MD but most of the tracts show a positive association. This suggests that higher levels of progesterone may be associated with decreased or altered white matter integrity and increased levels of diffusion. When analyzing pregnancy only, DSI found significant positive correlations with QA only. Interestingly, it appears that tracts in the cerebellum have the opposite relationship with progesterone compared to estrogen. Tracts in the cerebellum show a positive relationship between progesterone and AD, MD and MD. This suggests that higher levels of progesterone in the cerebellum are associated with increased levels of diffusion, a typical signal of weakened or decreased white matter integrity. 

### QA {.tabset}
```{r QA vars,echo=FALSE, results='hide',message=FALSE}
# ALl weeks 
prog_QA_all_pos <- read.csv(paste0(Prog_path,'QA/Allwks/pos_all_2.5.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

prog_QA_all_neg <- read.csv(paste0(Prog_path,'QA/Allwks/neg_ALL_2.5.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

# Pregnancy only

prog_QA_pregnancy_pos <- read.csv(paste0(Prog_path,'QA/pregnancy/pos_pregnancy-2.5.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

```
#### All weeks 
##### <span style="color: hotpink;"> Positive ( FDR= 0.002484 ) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(prog_QA_all_pos, row.names=F)
```
#####  <span class="text-center" style="color: Teal;"> Neg ( FDR= 0.250000)</span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(prog_QA_all_neg, row.names=F)
```

#####  <span class="text-center" style="color: Dark Blue;"> Figures </span> 
![Slice overlay image displaying ROIs with tracts that had QA positvely  correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/QA/Allwks/Prog_QA_allstages_pos_cor.png)

#####  <span class="text-center" style="color: Dark Blue;"> Negative Tracts  </span> \
![Slice overlay image displaying ROIs with tracts that had QA negatively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/QA/Allwks/Prog_QA_allstages_neg_cor.png)

#####  <span class="text-center" style="color: Dark Blue;"> Positive and Negative Tracts  </span> 
![Slice overlay image displaying ROIs with tracts that had QA positevely and negatively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/QA/Allwks/Prog_QA_allstages_both_cor.png)

![Glass Brain displaying tracts that had QA positively and negatively correlated with Progesterone levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/QA/Allwks/Prog_QA_allstages_pos_neg_allviewsglass.png)

#### Pregnancy only
##### <span style="color: hotpink;"> Positive ( FDR= 0.043802 ) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(prog_QA_pregnancy_pos, row.names=F)
```

#####  <span class="text-center" style="color: Teal;"> Neg ( FDR= 1.0000)</span> 
No significant Findings




### MD {.tabset}
```{r MD vars,echo=FALSE, results='hide',message=FALSE}
# ALl weeks 
prog_MD_all_pos <- read.csv(paste0(Prog_path,'MD/Allwks/MD_allwks_prog_pos_2.5.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

prog_MD_all_neg <- read.csv(paste0(Prog_path,'MD/Allwks/MD_allwks_prog_neg_2.5.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

```
#### All weeks 
##### <span style="color: hotpink;"> Positive ( FDR= 0.002484 ) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(prog_MD_all_pos, row.names=F)
```
#####  <span class="text-center" style="color: Teal;"> Neg ( FDR= 0.250000)</span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(prog_MD_all_neg, row.names=F)
```

#####  <span class="text-center" style="color: Dark Blue;"> Positive Tracts </span> 
![Slice overlay image displaying ROIs with tracts that had MD positively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/MD/Allwks/Prog_MD_allstages_pos_cor.png)

![Glass Brain displaying tracts that had MD positively correlated with Progesterone levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/MD/Allwks/Progesterone.t2.length25.pos_corr.jpg)

#####  <span class="text-center" style="color: Dark Blue;"> Negative Tracts  </span> 
![Slice overlay image displaying ROIs with tracts that had MD and negatively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/MD/Allwks/Prog_MD_allstages_neg_cor.png)

![Glass Brain displaying tracts that had MD negatively correlated with Progesterone levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/MD/Allwks/Progesterone.t2.length25.neg_corr.jpg)

#####  <span class="text-center" style="color: Dark Blue;"> Positive and Negative Tracts  </span> 
![Slice overlay image displaying ROIs with tracts that had MD positively and negatively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/MD/Allwks/Prog_MD_allstages_both_cor.png)

![Glass Brain displaying tracts that had MD positively and negatively correlated with Progesterone levels across all gestational weeks](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/MD/Allwks/Progesterone.t2.length25.pos_neg.jpg)

#### Pregnancy only
No significant Findings

### AD {.tabset}
```{r AD vars,echo=FALSE, results='hide',message=FALSE}
# ALl weeks 
prog_AD_all_pos <- read.csv(paste0(Prog_path,'AD/Allwks/AD_allwks_prog_pos_2.5.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

prog_AD_all_neg <- read.csv(paste0(Prog_path,'AD/Allwks/AD_allwks_prog_neg_2.5.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

```
#### All weeks 
##### <span style="color: hotpink;"> Positive ( FDR= 0.002484 ) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(prog_AD_all_pos, row.names=F)
```
#####  <span class="text-center" style="color: Teal;"> Neg ( FDR= 0.250000)</span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(prog_AD_all_neg, row.names=F)
```
##### <span class="text-center" style="color: Dark Blue;"> Positive Tracts </span> 
![Slice overlay image displaying ROIs with tracts that had AD positively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/AD/Allwks/Prog_AD_allwks_pos_cor.png)

![Glass Brain displaying tracts that had AD positively correlated with Progesterone ](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/AD/Allwks/Progesterone.t2.length25.pos_corr.jpg)

#####  <span class="text-center" style="color: Dark Blue;"> Negative Tracts  </span> 
![Slice overlay image displaying ROIs with tracts that had AD negatively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/AD/Allwks/Prog_AD_allwks_neg_cor.png)

![Glass Brain displaying tracts that had AD negatively correlated with Progesterone ](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/AD/Allwks/Progesterone.t2.length25.neg_corr.jpg)


#####  <span class="text-center" style="color: Dark Blue;"> Positive and Negative Tracts  </span> 
![Glass Brain displaying tracts that had AD positively and  negatively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/AD/Allwks/Progesterone.t2.length25.pos_neg.jpg)

#### Pregnancy only
No significant Findings

### RD {.tabset}
```{r RD vars,echo=FALSE, results='hide',message=FALSE}
# ALl weeks 
prog_RD_all_pos <- read.csv(paste0(Prog_path,'RD/Allwks/RD_allwks_prog_pos_2.5.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

prog_RD_all_neg <- read.csv(paste0(Prog_path,'RD/Allwks/RD_allwks_prog_neg_2.csv'), header=FALSE) %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame()

```
#### All weeks 
##### <span style="color: hotpink;"> Positive ( FDR= 0.002484 ) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(prog_RD_all_pos, row.names=F)
```
#####  <span class="text-center" style="color: Teal;"> Neg ( FDR= 0.250000)</span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(prog_RD_all_neg, row.names=F)
```
#####  <span class="text-center" style="color: Dark Blue;"> Positive Tracts  </span> 
![Slice overlay image displaying ROIs with tracts that had RD positively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/RD/Allwks/Prog_RD_allwks_pos_cor.png)

![Glass Brain displaying tracts that had RD positively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/RD/Allwks/Progesterone.t2.length25.pos_corr.jpg)

#####  <span class="text-center" style="color: Dark Blue;"> Negative Tracts  </span> 
![Slice overlay image displaying ROIs with tracts that had RD negatively correlated with Progesterones](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/RD/Allwks/Prog_RD_allwks_neg_cor.png)

![Glass Brain displaying tracts that had RD negatively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/RD/Allwks/Progesterone.t2.length25.neg_corr.jpg)

#####  <span class="text-center" style="color: Dark Blue;"> Positive and Negative Tracts  </span> 
![Slice overlay image displaying ROIs with tracts that had ARD positively and negatively correlated with Progesterone](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/RD/Allwks/Prog_RD_allwks_both_cor.png)

![Glass Brain displaying tracts that had AD positively and negatively correlated with Progesterones](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/progesterone/RD/Allwks/Progesterone.t2.length25.pos_neg.jpg)


#### Pregnancy only
No significant Findings


## <span style="color: magenta;"> Gestational Week  </span>  {.tabset .tabset-dropdown}

### Summary 
Diffusion MRI connectometry (Yeh et al. NeuroImage 125 (2016): 162-171) was used to derive the correlational tractography that has QA, AD, RD and MD correlated with GestWeek. A nonparametric Spearman correlation was used to derive the correlation. Subjects with GestWeek were selected. A total of 12 subjects were included in the analysis. A T-score threshold of 2.5 was assigned and tracked using a deterministic fiber tracking algorithm (Yeh et al. PLoS ONE 8(11): e80713, 2013) to obtain correlational tractography. A seeding region was placed at whole brain (39,49,29) . The tracks were filtered by topology-informed pruning (Yeh et al. Neurotherapeutics, 16(1), 52-58, 2019) with 4 iteration(s). A length threshold of 25 voxel distance was used to select tracks. To estimate the false discovery rate, a total of 4000 randomized permutations were applied to the group label to obtain the null distribution of the track length.

### QA {.tabset}
```{r QA Gestational WEek QA,echo=FALSE, results='hide',message=FALSE}
# Pre and during pregnancy weeks up to week 40 

gest_QA_pos <- read.delim(paste0(Gest_path,'QA/Pre_Preg_wks/QA_gestWeek_PreandPreg_pos.csv'), header=FALSE, sep="\t") %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame() %>% na.omit()

gest_QA_cols <- c("Subjects", as.character(gest_QA_pos[,1]))

# prepping for figs
gest_QA_pos_values <-
  read.csv(paste0(Gest_path, 'QA/Pre_Preg_wks/QA_gestWeek_PreandPreg_pos.csv'), header = FALSE) %>%
  filter(str_detect(V1, c("mean_qa"))) %>%
  filter(!str_detect(V1, c("mean_qa_post_norm"))) %>%
  `colnames<-`(estr_MD_cols) %>%
  mutate(estrogen = Gest_subinfo$Estrogen) %>% 
  mutate(status = as.factor(Gest_subinfo$`Endocrine Status`)) %>% 
  mutate(trimester = factor(Gest_subinfo$trimester, levels= c('pre','first','second', 'third', 'post')))

# Reorder for my sanity check 
gest_QA_pos_values <- gest_QA_pos_values[,c(1,5:7,2:4)]
MD_est_gathercols <- colnames(gest_QA_pos_values[5:7])

# for some reason things are being read as a a character and it needs to be a numerical value
gest_QA_pos_values[5:7] <- apply(gest_QA_pos_values[5:7],2, as.numeric) 

## GAther it long for large compiled figure
gest_QA_pos_values_long <- gather(gest_QA_pos_values, ROI, QA ,MD_est_gathercols, factor_key = TRUE) %>% select(!(Subjects))

```
#### Weeks 1-40
##### <span style="color: hotpink;"> Positive ( FDR= 0.000214 ) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(gest_QA_pos, row.names=F)
```
#####  <span class="text-center" style="color: Teal;"> Neg ( FDR= 1.000000)</span> 
No Significant Findings 

#####  <span class="text-center" style="color: Dark Blue;"> Figures </span> 
![Slice overlay  displaying ROIs with tracts that had QA Positively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/QA/Pre_Preg_wks/QA_gest_Pre_Preg_pos_cor.png)


![Directional glass brain displaying tracts that had QA Positively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/QA/Pre_Preg_wks/GestWeek.t2.length25.pos_corr.jpg)

![Glass brain displaying tracts that had QA Positively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/QA/Pre_Preg_wks/GestWeek.t2.length25.pos_neg.jpg)



```{r, Gestational QA}
gest_QA_figpath <- "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/estrogen/MD/Allwks/"

for (ROI in QA_gest_gathercols) {
  print(ROI)
  y <- gest_QA_all_neg_values %>%
    ggplot( aes(x=trimester, y=gest_QA_all_neg_values[[ROI]], group=trimester)) +
      geom_boxplot(width=0.5 ,fill= c("#CF92BF", "#D1E7E6", "#A8D2C6", "#6AA390","#90A0C9")) +
      scale_y_binned(n.breaks=10, nice.breaks = TRUE) +
      labs(x= "Trimester", y= " MD", title =paste0(ROI) ) +
      theme(axis.title.x = element_text(vjust=- 4, size = 16),
            axis.title.y = element_text(vjust=8, size = 16), 
            axis.text.x = element_text(size = 12),
            axis.text.y = element_text(size = 12),
            panel.background =element_blank(),
            axis.line = element_line(colour = "black"),  
            plot.margin = margin(1, 2, 1, 1.5, "cm"), 
            plot.title = element_text(hjust = 0.5, vjust = 2, size = 16, face="bold"))
  
   png(file = paste0(gest_QA_figpath ,ROI,".png"))
   print(y)
   dev.off()
}
```

### MD {.tabset}
```{r Gestational MD vars,echo=FALSE, results='hide',message=FALSE}
# ALl weeks 
gest_MD_pos <- read.delim(paste0(Gest_path,'MD/Pre_Preg_wks/MD_gestWeek_PreandPreg_pos.csv'), header=FALSE, sep="\t") %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame() %>% na.omit()

gest_MD_neg <- read.delim(paste0(Gest_path,'MD/Pre_Preg_wks/MD_gestWeek_PreandPreg_neg.csv'), header=FALSE, sep="\t") %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame() %>% na.omit()

```
#### All weeks 
##### <span style="color: hotpink;"> Positive ( FDR= 0.066667 ) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(gest_MD_pos, row.names=F)
```
#####  <span class="text-center" style="color: Teal;"> Neg ( FDR= 0.021684)</span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(gest_MD_neg, row.names=F)
```

#####  <span class="text-center" style="color: Dark Blue;"> Figures </span> 
![Directional glass brain displaying tracts that had MD Positively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/MD/Pre_Preg_wks/GestWeek.t2.length25.pos_corr.jpg)

![Slice overlay  displaying ROIs with tracts that had MD Positively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/MD/Pre_Preg_wks/MD_gest_Pre_Preg_Pos_roi_cor.png)


![Directional glass brain displaying tracts that had MD Negatively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/MD/Pre_Preg_wks/GestWeek.t2.length25.neg_corr.jpg)

![Slice overlay  displaying ROIs with tracts that had MD Neg correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/MD/Pre_Preg_wks/MD_gest_Pre_Preg_neg_roi_cor.png)


![Glass brain displaying tracts that had MD positively and negatively  correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/MD/Pre_Preg_wks/GestWeek.t2.length25.pos_neg.jpg)


### AD {.tabset}
```{r Gestational AD vars,echo=FALSE, results='hide',message=FALSE}
gest_AD_neg <- read.delim(paste0(Gest_path,'AD/Pre_Preg_wks/AD_gestWeek_PreandPreg_neg.csv'), header=FALSE, sep="\t") %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame() %>% na.omit()


```
#### Weeks 1-40
##### <span style="color: hotpink;"> Positive ( FDR= 0.273504 ) </span> 
No Significant Tracts

#####  <span class="text-center" style="color: Teal;"> Neg ( FDR= 0.007377)</span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(gest_AD_neg, row.names=F)
```

##### <span class="text-center" style="color: Dark Blue;"> Figures </span> 

![Slice overlay  displaying ROIs with tracts that had AD negatively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/AD/Pre_Preg_wks/AD_gest_Pre_Preg_neg_cor.png)

![Directional glass brain displaying tracts that had AD Negatively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/AD/Pre_Preg_wks/GestWeek.t2.length25.neg_corr.jpg)

![Glass brain displaying tracts that had AD negatively  correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/AD/Pre_Preg_wks/GestWeek.t2.length25.pos_neg.jpg)


### RD {.tabset}
```{r GEstational RD vars,echo=FALSE, results='hide',message=FALSE}
# ALl weeks 
gest_RD_pos <- read.delim(paste0(Gest_path,'RD/Pre_Preg_wks/RD_gestWeek_PreandPreg_pos.csv'), header=FALSE, sep="\t") %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame() %>% na.omit()

gest_RD_neg <- read.delim(paste0(Gest_path,'RD/Pre_Preg_wks/RD_gestWeek_PreandPreg_neg.csv'), header=FALSE, sep="\t") %>%  filter(V1 %in% rows2grab) %>% t() %>% `colnames<-`(rows2grab) %>% `[`(-c(1),) %>% as.data.frame() %>% na.omit()

```
#### Weeks 1-40
##### <span style="color: hotpink;"> Positive ( FDR= 0.200000 ) </span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(gest_RD_pos, row.names=F)
```
#####  <span class="text-center" style="color: Teal;"> Neg ( FDR= 0.200000)</span> 
```{r, layout="l-body-outset",echo=FALSE}
knitr::kable(gest_RD_neg, row.names=F)
```

#####  <span class="text-center" style="color: Dark Blue;"> Figures </span> 
![Slice overlay  displaying ROIs with tracts that had RD positively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/RD/Pre_Preg_wks/RD_gest_Pre_Preg_pos_roi_ax.png)

![Directional glass brain displaying tracts that had RD Positively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/RD/Pre_Preg_wks/GestWeek.t2.length25.pos_corr.jpg)

![Slice overlay  displaying ROIs with tracts that had RD negatively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/RD/Pre_Preg_wks/RD_gest_Pre_Preg_neg_roi_cor.png)

![Directional glass brain displaying tracts that had RD Negatively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/RD/Pre_Preg_wks/GestWeek.t2.length25.neg_corr.jpg)

![Slice overlay  displaying ROIs with tracts that had RD  positvely and negatively correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/RD/Pre_Preg_wks/RD_gest_Pre_Preg_both_roi_ax.png)

![Glass brain displaying tracts that had MD positively and negatively  correlated with Gestational Week (Weeks 1-40)](/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/28andB/GestationalWks/RD/Pre_Preg_wks/GestWeek.t2.length25.pos_neg.jpg)

# Results Write up 

## END


