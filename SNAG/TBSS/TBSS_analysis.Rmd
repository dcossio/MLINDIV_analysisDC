---
title: "MIDLIFE TBSS"
author: "Daniela Cossio"
date: "09/14/2023"
mainfont: Times
output:
   html_document:
    toc: true
    toc_float: true
    toc_depth: 6
    theme: flatly
---

```{css, echo=FALSE}
h1, h2, h3, h4, h5 ,h6 {
  text-align: center;
  font-family: Times;
  
}

h1, h2 {
background-color: LightSteelBlue;
  font-weight: bold;
}

body, p {
  color: black; 
  font-family: Times;
}


```

``` {r, libraries, echo=FALSE, results='hide',message=FALSE}
library(ggplot2)
#(plyr)
library(tidyverse)
# library(dplyr)
# library(tidyr)
library(stringr)
library(kableExtra)
# library(data.table)
# library(network)
# library(tidygraph)
# library(ggraph)
# library(igraph)
# library(networkD3)
# library(CINNA)
# library(umap)
# library(plotly)
#library(factoextra)
#library(lsr)
# library(car)
library(ggpubr)
#library(entropy)
#library(ds4psy)
# library(pROC)
#library(devtools)
#library(BRRR)
#library(stats)
#library(afex)
library(knitr)
library(janitor)
library(car)
library(ggiraph)
library(ggiraphExtra)
library(moonBook)
library(nationalparkcolors)
library(gridExtra)
library(markdown)
library(ppcor)
library(mediation)

```

``` {r, Functions for analyses, echo=FALSE, results='hide',message=FALSE}

CheckDistribution <- function(dataframe,threshold){
  
  # Purpose of this is to take in a tbss csv dataframe and checking the distribution of each ROI. Then it spits out all the regions that are not normally distributed. 
  normality_check<- data.frame(matrix(ncol = 2, nrow = 0))

  for (roi in c(ROIs$V2)){
    
    df <- data.frame(matrix(ncol = 2, nrow = 1))
    
    normcheck <- shapiro.test(dataframe[[roi]])
    
    if (normcheck[["p.value"]] < threshold) {

      df$X1 <- roi
      df$X2 <- normcheck[["p.value"]]
      # 
      normality_check <- rbind(normality_check,df)
    }
  }
  
  colnames(normality_check) <- c("ROI","p.value")
  return(normality_check)
}


# Craeting tables for html
TableOutput <- function(df, style, width, height){
  
  if (style == "classic"){
      knitr::kable(df, row.names=F) %>% kable_classic(full_width = F, html_font = "Cambria")
    
  } else {
      knitr::kable(df, row.names=F) %>% kable_styling(bootstrap_options =  c("striped", "hover", "condensed")) %>% scroll_box(width = paste0(width,"px"), height = paste0(height,"px")) 
    
  }

}



RunningPcorTest <- function(dataframe, task, covariates){
  

  # Here we need a clean dataframe that contains only on wm metric (FA,AD,RD, MD) and it needs to be combined with the subject info data that we need. here i need maze accuracy, sex, and age. Also, need to remove any rows with NW
  
  finalDF <-   data.frame(matrix(ncol = 7, nrow = 0))
  
  for (roi in c(ROIs$V2)){
    
    df <- data.frame(matrix(ncol = 6, nrow = 1))
    
    pcortestresults <-pcor.test(dataframe[[roi]],dataframe[[task]], dataframe[, c(covariates)])
    
    if (pcortestresults$p.value < 0.05) {

      df$X1 <- roi
      df[,2:7] <- pcortestresults
      # 
      finalDF <- rbind(finalDF,df)
    }
  }
  colnames(finalDF) <- c("ROI", colnames(pcortestresults))
  return(finalDF)
}

AprioriPcorTest <-  function(dataframe,task, covariates){
  
  # Here we have our list of ROIS
  list_rois <- c("fornix_body", "fornix_R", "fornix_L","Cingulum_(cingulate_gyrus)_R","Cingulum_(cingulate_gyrus)_L","Cingulum_(hippocampus)_R", "Cingulum_(hippocampus)_L")


  DF <-dataframe %>% filter(!is.na(dataframe[[task]]))
  finalDF <- data.frame(matrix(ncol = 7, nrow = 0))

 for (roi in c(list_rois)){
    df <- data.frame(matrix(ncol = 6, nrow = 1))
    
    pcortestresults <- pcor.test(DF[[roi]],DF[[task]],DF[, c(covariates)],method = "spearman")
    #
    df$X1 <- roi
    df[,2:7] <- pcortestresults
    #   # 
    finalDF <- rbind(finalDF,df)
    # 
 }
  colnames(finalDF) <- c("ROI", colnames(pcortestresults))
  return(finalDF)

}


GetAprioriDF <- function(dataframe){
  
  # List of a prior rois 
  apriori_ROIS <- c("Fornix_(column_and_body_of_fornix)","Fornix_(cres)_/_Stria_terminalis_(can_not_be_resolved_with_current_resolution)_R","Fornix_(cres)_/_Stria_terminalis_(can_not_be_resolved_with_current_resolution)_L", "Cingulum_(cingulate_gyrus)_R","Cingulum_(cingulate_gyrus)_L","Cingulum_(hippocampus)_R", "Cingulum_(hippocampus)_L")
  
  # clean up the names 
  df <- dataframe %>% dplyr::select(. ,apriori_ROIS) %>% `colnames<-`(c("fornix_body", "fornix_R", "fornix_L","Cingulum_(cingulate_gyrus)_R","Cingulum_(cingulate_gyrus)_L","Cingulum_(hippocampus)_R", "Cingulum_(hippocampus)_L"))
  
  return(df)
}


```

# Overview 
This is the analysis of white matter using FSLs TBSS

<br>

# <span style="color: darkblue;">Methods </span> 

**Participants** 

  * Total number of scans = 120 (males and females)  
  
  * Total scans used in analysis= 118  
  * Excluded subs 329 and 372 from analyses due to bad behavior data and Subject 347 failed quality 
  control check in DSI

<br>

  **Scan parameters** 

  * Locations from UCSB and UCI
<br>

**QSIprep** 

  * Version used: 0.16.0RC3

  * The following parameters were used
    * dwi_denoise_window **5** 
    * hmc_model **3dSHORE** 
    * hmc-transform **Rigid** 
    * shoreline_iters **2**
<br>

**Preprocessing for FSL** 

The data needs to be reconstructed and prepared for FSL.

  * Run FSL dti fit in order to extract our statistics. It fits a tensor model at each voxel.
    * You need the following inputs 
      * DWI scan images
      * BRain mask image
      * Output name 
      * Bvec files
      * B value files
      
  * We need to reorient the images to be in the same format as FSL atlases. 
    * We run FSL reorient on each image 

<br>
**FSL TBSS**

  * **Step 1:** tbss _1_preproc *nii.gz
    * this prepares the data for full preprocessing 
    
    <br>
  * **Step 2:** tbss_2_reg
    * This runs a nonlinear registration and creates transforms of all the images in order to put them into a standard space 
    
    <br>
  * **Step 3:** tbss_3_postreg
    * Applies all of the transofrms created in the previous step
    
    <br>
  * **Intermediate Step:** Quality check
    * Open all images in FSL and visually inspect that they line up with the mean FA 
    
    <br>
  * **Step 4:** tbss_4_prestats
    * Creates a threshold for each of the masks in order to extract stats 
    
    <br>
  * **Custom scripts** 
    * here we use custoim fsl maths and meants scripts in order to extract our values for the JHU atlas
    
<br><br>

## Overall approach for analysis
First, I will run analysis using our aprior rois 
  - Fornix 
  - Cingulum bundle (L and R) 
  
  Here, I will run a partial correlation and control for sex and age. Then I will run a multiple linear     regression using sex and age as covariates. Then If there is a sex effect, I will run a sex            stratisfied analysis using a partial correlation and controlling for age. </p>

<br><br>


# Results 
```{r REad in our CSVS, echo=FALSE, results='hide',message=FALSE}

# Lets read in our subject information
top_workdir <-"/Users/danielacossio/Documents/Chrastil_Lab/Projects/SNAG/MIDLIFE_TBSS/"
  # laptop path "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/Other computers/My iMac/Chrastil_Lab/Projects/SNAG/MIDLIFE_TBSS/"

ROIs <- read.table(paste0(top_workdir,"JHU-WhiteMatter-labels-1mm.txt")) %>% dplyr::select(V2)

sub_info_master <- read.csv(paste0(top_workdir,"subject_info.csv"))

raw_FA <- read.csv(paste0(top_workdir,"JHU-skeletonized-FA.csv"), header=FALSE) %>% remove_empty(. ,which = "cols") %>% `colnames<-`(c(ROIs$V2)) 

raw_MD <- read.csv(paste0(top_workdir,"JHU-skeletonized-MD.csv"))  %>% remove_empty(. ,which = "cols") %>% `colnames<-`(c(ROIs$V2))

raw_AD <- read.csv(paste0(top_workdir,"JHU-skeletonized-AD.csv")) %>% remove_empty(. ,which = "cols") %>% `colnames<-`(c(ROIs$V2))

raw_RD <- read.csv(paste0(top_workdir,"JHU-skeletonized-RD.csv")) %>% remove_empty(. ,which = "cols") %>% `colnames<-`(c(ROIs$V2))

```

## <span style="color: darkorange;"> Behavior Distributions </span>  {.tabset .tabset-pills} 

### Maze Accuracy 

```{r, echo=FALSE,results='hide', message=FALSE, out.width="50%"}

# All
ggplot(sub_info_master, aes(x= maze_accuracy_pct)) +
  geom_histogram()


#By sex
ggplot(sub_info_master, aes(x= maze_accuracy_pct, fill =sex, color=sex)) +
  geom_histogram()


```
<br>

Let's just double check that by running a normality test.  
```{r,echo=FALSE, results='hide', message=FALSE}
#Normality Check
maze_norm <- shapiro.test(sub_info_master$maze_accuracy_pct)
maze_norm[["p.value"]]
```

The data is not normally distributed with p = `r maze_norm[["p.value"]]`.

<br><br>

### DSP
```{r, echo=FALSE,results='hide', message=FALSE, out.width="50%"}

# All
ggplot(sub_info_master, aes(x= dsp_si_true_pct)) +
  geom_histogram()


#By sex
ggplot(sub_info_master, aes(x= dsp_si_true_pct, fill =sex, color=sex)) +
  geom_histogram()
```

<br>

Let's just double check that by running a normality test.  
```{r,echo=FALSE, results='hide', message=FALSE}
#Normality Check
DSP_norm <- shapiro.test(sub_info_master$dsp_si_true_pct)
DSP_norm[["p.value"]]
```

<br><br>

### Loop {.tabset .tabset-pills} 
#### AE
Average
```{r, echo=FALSE,results='hide', message=FALSE, out.width="50%"}

# All
ggplot(sub_info_master, aes(x= loop_ae_avg_degree)) +
  geom_histogram(bins=10)

#By sex
ggplot(sub_info_master, aes(x= loop_ae_avg_degree, fill =sex, color=sex)) +
  geom_histogram(bins=10)
```

Rad3
```{r, echo=FALSE,results='hide', message=FALSE, out.width="50%"}

# All
ggplot(sub_info_master, aes(x=loop_ae_rad3_degree )) +
  geom_histogram(bins=10)

#By sex
ggplot(sub_info_master, aes(x= loop_ae_rad3_degree, fill =sex, color=sex)) +
  geom_histogram(bins=10)
```

#### DE
Average
```{r, echo=FALSE,results='hide', message=FALSE, out.width="50%"}

# All
ggplot(sub_info_master, aes(x= loop_de_avg_degree)) +
  geom_histogram(bins=10)

#By sex
ggplot(sub_info_master, aes(x= loop_de_avg_degree, fill =sex, color=sex)) +
  geom_histogram(bins=10)
```

Rad3
```{r, echo=FALSE,results='hide', message=FALSE, out.width="50%"}

# All
ggplot(sub_info_master, aes(x= loop_de_rad3_degree)) +
  geom_histogram(bins=10)

#By sex
ggplot(sub_info_master, aes(x= loop_de_rad3_degree, fill =sex, color=sex)) +
  geom_histogram(bins=10)
```

#### PE
Average
```{r, echo=FALSE,results='hide', message=FALSE, out.width="50%"}

# All
ggplot(sub_info_master, aes(x= loop_pe_avg_m)) +
  geom_histogram(bins=10)

#By sex
ggplot(sub_info_master, aes(x= loop_pe_avg_m, fill =sex, color=sex)) +
  geom_histogram(bins=10)
```

Rad3
```{r, echo=FALSE,results='hide', message=FALSE, out.width="50%"}

# All
ggplot(sub_info_master, aes(x= loop_pe_rad3_m)) +
  geom_histogram(bins=10)

#By sex
ggplot(sub_info_master, aes(x= loop_pe_rad3_m, fill =sex, color=sex)) +
  geom_histogram(bins=10)
```



<br><br>

## <span style="color: darkorange;"> FA </span>  {.tabset } 

### Apriori { .tabset .tabset-dropdown .tabset-fade .tabset-pills}

First, let's start with our apriori regions: Fornix body fornix (L and R), Cingulum bundle (cingulate gyrus and hippocampus ) L and R. 

```{r, echo=FALSE,results='hide', message=FALSE }
#  Creating our data frame  by taking apriori rois and also renaming them for a clean name and binding them with or subject information
apriori_FA <- GetAprioriDF(raw_FA) %>% cbind(sub_info_master, .)

male_apriori_FA <- GetAprioriDF(raw_FA) %>% cbind(sub_info_master, .) %>% filter(sex == "Male")

female_apriori_FA <- GetAprioriDF(raw_FA) %>% cbind(sub_info_master, .) %>% filter(sex == "Female")

```

#### Maze Accuracy

<p style="text-align:center; font-family: times; font-size: 20px" > <strong>Partial Correlations</strong> </p>

<p style="font-family: times" > 
Here we want to know whether ROIs correlate to our different behavioral variables when we control for age and sex. So we will run partial correlations.When controlling for age and sex, our ROIS are not significantly correlated </p>

<br>

```{r, echo=FALSE, message=FALSE }
FA_maze_results <- AprioriPcorTest(dataframe = apriori_FA, task ="maze_accuracy_pct",covariates = c("sex.1","age_scan_years"))
TableOutput(FA_maze_results,"classic",500,300)

```

<br>

<p style="text-align:center ; font-size: 20px" > <strong>Multiple Linear Regression</strong> </p> 
Here, I will runa  multiple linear regression so examine the relationship between roi and performance. formula used is accuracy ~ ROI_FA + Sex + age_scan_years. Age appears to be the larger factor here not sex or even ROI in predicting maze accuracy behavior. Fornix body was the only ROI with a significant sex effect just barely p = 0.046. Cingulum ROIs appeared to have a trend for sex and age p>0.05.

```{r, echo=FALSE,results='hide', message=FALSE }
apriori_rois <- c("fornix_body", "fornix_R", "fornix_L","Cingulum_(cingulate_gyrus)_R","Cingulum_(cingulate_gyrus)_L","Cingulum_(hippocampus)_R", "Cingulum_(hippocampus)_L")

maze_FA_models<- vector(mode='list', length=length(apriori_rois))

for (roi in 1:length(apriori_rois)){
    
    
    maze_FA_models[[roi]] <- broom::tidy(lm(maze_accuracy_pct ~ apriori_FA[[apriori_rois[roi]]] + sex.1 + age_scan_years, data = apriori_FA))
    
    names(maze_FA_models)[roi] <- apriori_rois[roi]
    
    maze_FA_models[[roi]]["term"][2,] <- apriori_rois[roi]
    maze_FA_models[[roi]]["term"][3,] <- "sex"
    maze_FA_models[[roi]]["term"][4,] <- "age"
}

```

<br>

##### **ROIS** {.tabset .tabset-dropdown}
###### Fornix 

<p style= "text-align: center;"> Fornix Body </p> 
`r TableOutput(maze_FA_models[["fornix_body"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Fornix R </p> 
`r TableOutput(maze_FA_models[["fornix_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Fornix L </p> 
`r TableOutput(maze_FA_models[["fornix_L"]], "classic", 500,150) `
<br>

###### Cingulum 

<p style= "text-align: center;">Cingulum_(cingulate_gyrus)_R </p> 
`r TableOutput(maze_FA_models[["Cingulum_(cingulate_gyrus)_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(cingulate_gyrus)_L </p> 
`r TableOutput(maze_FA_models[["Cingulum_(cingulate_gyrus)_L"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(hippocampus)_R </p> 
`r TableOutput(maze_FA_models[["Cingulum_(hippocampus)_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(hippocampus)_L </p> 
`r TableOutput(maze_FA_models[["Cingulum_(hippocampus)_R"]], "classic", 500,150) `
<br>

#### Dual Solution Paradigm 

<p style="text-align:center; font-family: times; font-size: 20px" > <strong>Partial Correlations</strong> </p>

When controlling for age and sex, fornix body appears to be significantly correlated with maze accuracy 
```{r, echo=FALSE, message=FALSE }
FA_DSP_results <- AprioriPcorTest(dataframe = apriori_FA, task ="dsp_si_true_pct",covariates = c("sex.1","age_scan_years"))
TableOutput(FA_DSP_results, "classic")

```


<p style="text-align:center; font-family: times; font-size: 20px" > <strong>Multiple Linear Regression</strong> </p>


Mostly effects of age with some effects of sex. Fornix body appears to have an effect of sex.
```{r, echo=FALSE,results='hide', message=FALSE }

apriori_rois <- c("fornix_body", "fornix_R", "fornix_L","Cingulum_(cingulate_gyrus)_R","Cingulum_(cingulate_gyrus)_L","Cingulum_(hippocampus)_R", "Cingulum_(hippocampus)_L")

DSP_FA_models<- vector(mode='list', length=length(apriori_rois))

for (roi in 1:length(apriori_rois)){
    
    
    DSP_FA_models[[roi]] <- broom::tidy(summary(lm(maze_accuracy_pct ~ apriori_FA[[apriori_rois[roi]]] + sex.1 + age_scan_years, data = apriori_FA)))
    
    names(DSP_FA_models)[roi] <- apriori_rois[roi]
    DSP_FA_models[[roi]]["term"][2,] <- apriori_rois[roi]
    DSP_FA_models[[roi]]["term"][3,] <- "sex"
    DSP_FA_models[[roi]]["term"][4,] <- "age"
}

```

##### **ROIS** {.tabset .tabset-dropdown}

###### Fornix 

<p style= "text-align: center;"> Fornix Body </p> 
`r TableOutput(DSP_FA_models[["fornix_body"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Fornix R </p> 
`r TableOutput(DSP_FA_models[["fornix_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Fornix L </p> 
`r TableOutput(DSP_FA_models[["fornix_L"]], "classic", 500,150) `
<br>

###### Cingulum 

<p style= "text-align: center;">Cingulum_(cingulate_gyrus)_R </p> 
`r TableOutput(DSP_FA_models[["Cingulum_(cingulate_gyrus)_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(cingulate_gyrus)_L </p> 
`r TableOutput(DSP_FA_models[["Cingulum_(cingulate_gyrus)_L"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(hippocampus)_R </p> 
`r TableOutput(DSP_FA_models[["Cingulum_(hippocampus)_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(hippocampus)_L </p> 
`r TableOutput(DSP_FA_models[["Cingulum_(hippocampus)_R"]], "classic", 500,150) `
<br>

##### 

<p style="text-align:center; font-family: times; font-size: 20px" >  <strong>Sex stratified partial correlations</strong> </p>


For males, the fornix body and right cingulum hippocampus were significantly correlated 
```{r, echo=FALSE, message=FALSE }
FA_DSP_male_results <- AprioriPcorTest(dataframe = male_apriori_FA, task ="dsp_si_true_pct",covariates = c("age_scan_years"))
TableOutput(FA_DSP_male_results, "classic", 400, 200)
```

For women, nothing was significantly correlated 
```{r, echo=FALSE, message=FALSE }
FA_DSP_female_results <- AprioriPcorTest(dataframe = female_apriori_FA, task ="dsp_si_true_pct",covariates = c("age_scan_years"))
TableOutput(FA_DSP_female_results, "classic", 400, 200)
```


#### Loop Degrees Traveled {.tabset .tabset-dropdown}
##### Radius 3 

<p style="text-align:center; font-family: times; font-size: 20px" > <strong>Partial Correlations</strong> </p>

```{r, echo=FALSE, message=FALSE }
rad3_loopDE_results <- AprioriPcorTest(dataframe = apriori_FA, task ="loop_de_rad3_degree",covariates = c("sex.1","age_scan_years"))
TableOutput(rad3_loopDE_results,"classic",500,300)

```

<p style="text-align:center ; font-size: 20px" > <strong>Multiple Linear Regression</strong> </p> 

Sex appears to have the largest effect on all ROIs

```{r, echo=FALSE,results='hide', message=FALSE }
apriori_rois <- c("fornix_body", "fornix_R", "fornix_L","Cingulum_(cingulate_gyrus)_R","Cingulum_(cingulate_gyrus)_L","Cingulum_(hippocampus)_R", "Cingulum_(hippocampus)_L")

rad3_loopDE_models<- vector(mode='list', length=length(apriori_rois))

for (roi in 1:length(apriori_rois)){
    
    
    rad3_loopDE_models[[roi]] <- broom::tidy(lm(loop_de_rad3_degree ~ apriori_FA[[apriori_rois[roi]]] + sex.1 + age_scan_years, data = apriori_FA))
    
    names(rad3_loopDE_models)[roi] <- apriori_rois[roi]
    
    rad3_loopDE_models[[roi]]["term"][2,] <- apriori_rois[roi]
    rad3_loopDE_models[[roi]]["term"][3,] <- "sex"
    rad3_loopDE_models[[roi]]["term"][4,] <- "age"
}

```
**ROIS** 
<p style="text-align:center ; font-size: 20px" > <strong>Fornix</strong> </p>

<p style= "text-align: center;"> Fornix Body </p> 
`r TableOutput(rad3_loopDE_models[["fornix_body"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Fornix R </p> 
`r TableOutput(rad3_loopDE_models[["fornix_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Fornix L </p> 
`r TableOutput(rad3_loopDE_models[["fornix_L"]], "classic", 500,150) `
<br>

<p style="text-align:center ; font-size: 20px" > <strong>Cingulum</strong> </p>

<p style= "text-align: center;">Cingulum_(cingulate_gyrus)_R </p> 
`r TableOutput(rad3_loopDE_models[["Cingulum_(cingulate_gyrus)_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(cingulate_gyrus)_L </p> 
`r TableOutput(rad3_loopDE_models[["Cingulum_(cingulate_gyrus)_L"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(hippocampus)_R </p> 
`r TableOutput(rad3_loopDE_models[["Cingulum_(hippocampus)_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(hippocampus)_L </p> 
`r TableOutput(rad3_loopDE_models[["Cingulum_(hippocampus)_R"]], "classic", 500,150) `
<br>

<p style="text-align:center; font-family: times; font-size: 20px" >  <strong>Sex stratified partial correlations</strong> </p>

```{r, echo=FALSE, message=FALSE }
rad3_loopDE_male_results <- AprioriPcorTest(dataframe = male_apriori_FA, task ="loop_de_rad3_degree",covariates = c("age_scan_years"))
TableOutput(rad3_loopDE_male_results, "classic", 400, 200)
```


```{r, echo=FALSE, message=FALSE }
rad3_loopDE_female_results <- AprioriPcorTest(dataframe = female_apriori_FA, task ="loop_de_rad3_degree",covariates = c("age_scan_years"))
TableOutput(rad3_loopDE_female_results, "classic", 400, 200)
```


##### Average
<p style="text-align:center; font-family: times; font-size: 20px" > <strong>Partial Correlations</strong> </p>
```{r, echo=FALSE, message=FALSE }
ave_loopDE_results <- AprioriPcorTest(dataframe = apriori_FA, task ="loop_de_avg_degree",covariates = c("sex.1","age_scan_years"))
TableOutput(ave_loopDE_results,"classic",500,300)

```

<p style="text-align:center ; font-size: 20px" > <strong>Multiple Linear Regression</strong> </p> 

```{r, echo=FALSE,results='hide', message=FALSE }
apriori_rois <- c("fornix_body", "fornix_R", "fornix_L","Cingulum_(cingulate_gyrus)_R","Cingulum_(cingulate_gyrus)_L","Cingulum_(hippocampus)_R", "Cingulum_(hippocampus)_L")

ave_loopDE_models<- vector(mode='list', length=length(apriori_rois))

for (roi in 1:length(apriori_rois)){
    
    
    ave_loopDE_models[[roi]] <- broom::tidy(lm(loop_de_avg_degree ~ apriori_FA[[apriori_rois[roi]]] + sex.1 + age_scan_years, data = apriori_FA))
    
    names(ave_loopDE_models)[roi] <- apriori_rois[roi]
    
    ave_loopDE_models[[roi]]["term"][2,] <- apriori_rois[roi]
    ave_loopDE_models[[roi]]["term"][3,] <- "sex"
    ave_loopDE_models[[roi]]["term"][4,] <- "age"
}

```

**ROIS** 
<p style="text-align:center ; font-size: 20px" > <strong>Fornix</strong> </p>

<p style= "text-align: center;"> Fornix Body </p> 
`r TableOutput(ave_loopDE_models[["fornix_body"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Fornix R </p> 
`r TableOutput(ave_loopDE_models[["fornix_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Fornix L </p> 
`r TableOutput(ave_loopDE_models[["fornix_L"]], "classic", 500,150) `
<br>

<p style="text-align:center ; font-size: 20px" > <strong>Cingulum</strong> </p>

<p style= "text-align: center;">Cingulum_(cingulate_gyrus)_R </p> 
`r TableOutput(ave_loopDE_models[["Cingulum_(cingulate_gyrus)_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(cingulate_gyrus)_L </p> 
`r TableOutput(ave_loopDE_models[["Cingulum_(cingulate_gyrus)_L"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(hippocampus)_R </p> 
`r TableOutput(ave_loopDE_models[["Cingulum_(hippocampus)_R"]], "classic", 500,150) `
<br>

<p style= "text-align: center;">Cingulum_(hippocampus)_L </p> 
`r TableOutput(ave_loopDE_models[["Cingulum_(hippocampus)_R"]], "classic", 500,150) `
<br>

<p style="text-align:center; font-family: times; font-size: 20px" >  <strong>Sex stratified partial correlations</strong> </p>

```{r, echo=FALSE, message=FALSE }
ave_loopDE_male_results <- AprioriPcorTest(dataframe = male_apriori_FA, task ="loop_de_avg_degree",covariates = c("age_scan_years"))
TableOutput(ave_loopDE_male_results, "classic", 400, 200)
```


```{r, echo=FALSE, message=FALSE }
ave_loopDE_female_results <- AprioriPcorTest(dataframe = female_apriori_FA, task ="loop_de_avg_degree",covariates = c("age_scan_years"))
TableOutput(ave_loopDE_female_results, "classic", 400, 200)
```



#### Loop Position Error {.tabset .tabset-dropdown}



### Whole Brain
##### Partial Correlations
```{r, echo=FALSE,results='hide', message=FALSE }
# 
mazeFA <- sub_info_master %>% dplyr::select("subject_id","sex.1", "age_scan_years", "maze_accuracy_pct") %>% cbind(., raw_FA) %>% na.omit()

covs <- c("sex.1", "age_scan_years")
mazeFA_results <- RunningPcorTest(mazeFA,"maze_accuracy_pct", covs)
```

##### Multiple Linear Regressions
```{r, echo=FALSE, message=FALSE }
# 
finalDF <- vector(mode='list', length=nrow(ROIs))
  
  for (roi in 1:nrow(ROIs)){
    
    
    finalDF[[roi]] <- summary(lm(maze_accuracy_pct ~ mazeFA[[ROIs[roi,]]] + sex.1 + age_scan_years, data = mazeFA))
    
    names(finalDF)[roi] <- ROIs[roi,]
  }

ROIs2Check <- c()
index <- 0
for (roi in names(finalDF)){
  
  
  modelsummary <- as.data.frame(finalDF[[roi]][["coefficients"]]) 
  modelsummary <- filter(modelsummary, !(rownames(modelsummary) == "(Intercept)"))
  
  y <- sum(modelsummary$`Pr(>|t|)` < 0.05)
  if (y > 0){
    ROIs2Check[length(ROIs2Check)+ 1] <- roi
  }
}

TableOutput(as.data.frame(ROIs2Check),"none", 500, 200)

```

The following ROIs are ones that show some level of significance.

- Middle cerebellar showed a significant relationship between FA and maze accuracy but no impact of sex or age. 








## <span style="color: darkorange;"> MD </span>  {.tabset .tabset-dropdown}  