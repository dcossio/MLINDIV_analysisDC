---
title: "SNAG Cortical Thickness"
author: "Daniela Cossio"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
   html_document:
    toc: true
    toc_float: true
    toc_depth: 2
    classoption:
    - twocolumn
---

```{css, echo=FALSE}
TOC {
  color: #F6B2DB;
  font-family: Times;
  font-size: "16px"; 
  border-color: #F6B2DB;
}

h1.title {
  color: black ;
  font-family: Times;
  font-size: "72px";
  padding: "10px 0";
  background-color: #F6B2DB ;
  text-align: center;
}

h4.date {
  color: black ;
  font-family: Times;
  font-size: "34px";
  text-align: center;
}

h4.author {
  color: black;
  font-size: "34px";
  font-family: Times;
  text-align: center;
}


h2, h3, h4, h5 ,h6 {
  text-align: center;
  font-family: Times;
  
}

body, p, h2{
  color: black; 
  font-family: Times;
}

hr {
  height:5px;
  border-width:0;
  background-color: black ;
}



```

```{r set-options, echo=FALSE, cache=FALSE}
options(width = 100)
```

```{r adding libraries,echo=FALSE, results='hide',message=FALSE}
library(ggplot2)
#(plyr)
library(ppcor)
library(tidyverse)
# library(dplyr)
# library(tidyr)
library(stringr)
library(kableExtra)
# library(data.table)
# library(network)
# library(tidygraph)
# library(ggraph)
# library(igraph)
# library(networkD3)
# library(CINNA)
# library(umap)
# library(plotly)
#library(factoextra)
#library(lsr)
# library(car)
library(ggpubr)
#library(entropy)
#library(ds4psy)
# library(pROC)
#library(devtools)
#library(BRRR)
#library(stats)
#library(afex)
library(knitr)
library(janitor)
library(car)
library(ggiraph)
library(ggiraphExtra)
library(moonBook)
library(nationalparkcolors)
library(gridExtra)
library(markdown)
```

```{r, Functions, echo=FALSE, results='hide',message=FALSE}

ReadingCSVFunc <- function(pathname){
  
   #' @description: purpose of this is to read in CSVs and clean them up 
  #' @return: DF
  
  read.csv(paste0(working_dir, pathname), header=TRUE)
  
  
  
}

CleanDF <- function(DF,Variable){
  
  DF <- DF %>% select(-c("subject_id"))
  
  subinfo <- sub_info  %>% select(c("subject_id", "sex", "age_scan_years","repo_status",Variable))
  
  cleanedDF <- cbind(subinfo, DF) %>% drop_na()
  
  cleanedDF$sex[cleanedDF$sex=="Male"] <- 1 
  cleanedDF$sex[cleanedDF$sex=="Female"] <- 0
  cleanedDF$sex <- as.numeric(cleanedDF$sex)
  
    return (cleanedDF)
}


SelectAtlas <- function(Parcel,NetworkNum){
  #' @description: purpose of this is to read in and extract the ROIs from schaefer atlas you choose
  #' @return: A list of all the ROIs
  
  atlas_path <- ReadingCSVFunc(paste0("Schaefer2018_",Parcel,"Parcels_",NetworkNum, "Networks_order_FSLMNI152_1mm.Centroid_RAS.csv"))
  
  col_names <-c("subject_id",atlas_path$ROI.Name)
  
  return(col_names)
}

```

```{r reading in our CSVs, echo=FALSE, results='hide',message=FALSE}

working_dir <- "/Users/danielacossio/Documents/Chrastil_Lab/Projects/SNAG/Cortical_thickness/"
#working_dir <- "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/Other computers/My iMac/Chrastil_Lab/Projects/SNAG/Cortical_thickness/" # Laptop path

sub_info <- ReadingCSVFunc("subject_info.csv")%>% filter(!(subject_id %in% c("309", "341")))


CT_7network <- ReadingCSVFunc("master_CT400_parces7_networks.csv") %>% `colnames<-`(SelectAtlas(400,7)) %>%  arrange(subject_id) 

CT_17network <- ReadingCSVFunc("master_CT400_parces17_networks.csv") %>% `colnames<-`(SelectAtlas(400,17)) %>%  arrange(subject_id) 




```

# Overview and Hypothesis 
Let's choose a few apriori regions to follow up with. In  this case, I believe we can go with the somatosensory motor L and R.

General approach : Do correlation between each parcellation and variable and then average by network. 


# Path integration results 


## Position Error
### Average Angular error
```{r,echo=FALSE, results='hide',message=FALSE}

AE_ave_df <-CleanDF(CT_df,"loop_ae_avg_degree")

M_AE_ave_df <- CleanDF(CT_df,"loop_ae_avg_degree") %>% filter(sex==1)
F_AE_ave_df <- CleanDF(CT_df,"loop_ae_avg_degree") %>% filter(sex==0)


```

Let's try and look at scatter plots of our ROIs and our things. Out of 400 parcellations, let's focus on a lower ammount.

```{r}



for (ROI in colnames(QA_df[2:5])) {
  print(ROI)
  y <- ggplot(QA_df, aes(x=sex, y=.data[[ROI]], group=sex)) +
      geom_boxplot(outlier.shape = NA,width =0.5,fill= c("#CF92BF", "#D1E7E6")) +
      geom_jitter(color="black",size=0.8,alpha=0.9,width = 0.2) +
      #scale_y_binned(n.breaks=10, nice.breaks = TRUE) +
       stat_boxplot(geom = "errorbar",
               width = 0.15) +
      labs(x= "Sex", y= " QA", title =paste0(ROI)) +
      theme(axis.title.x = element_text(vjust=- 4, size = 16),
            axis.title.y = element_text(vjust=8, size = 16),
            axis.text.x = element_text(size = 12),
            axis.text.y = element_text(size = 12),
            panel.background =element_blank(),
            axis.line = element_line(colour = "black"),
            plot.margin = margin(1, 2, 1, 1.5, "cm"),
            plot.title = element_text(hjust = 0.5, vjust = 2, size = 16, face="bold"))


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    print(y)
    #dev.off()
}



```

Preliminary : LH_SomMotA_2 =0.044

```{r, Partial correlations with average}

pcor.test(x=M_AE_ave_df["loop_ae_avg_degree"],y=M_AE_ave_df["17Networks_RH_SomMotA_6"],z= M_AE_ave_df[,c("age_scan_years")])
```

# ROIs


