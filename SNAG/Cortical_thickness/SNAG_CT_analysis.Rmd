---
title: "SNAG Cortical Thickness"
author: "Daniela Cossio"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
   html_document:
    toc: true
    toc_float: true
    toc_depth: 2
    classoption:
    - twocolumn
---

```{css, echo=FALSE}
TOC {
  color: #F6B2DB;
  font-family: Times;
  font-size: "16px"; 
  border-color: #F6B2DB;
}

h1.title {
  color: black ;
  font-family: Times;
  font-size: "72px";
  padding: "10px 0";
  background-color: #F6B2DB ;
  text-align: center;
}

h4.date {
  color: black ;
  font-family: Times;
  font-size: "34px";
  text-align: center;
}

h4.author {
  color: black;
  font-size: "34px";
  font-family: Times;
  text-align: center;
}


h1,h2, h3, h4, h5 ,h6 {
  text-align: center;
  font-family: Times;
  
}

body, p, h2{
  color: black; 
  font-family: Times;
}

hr {
  height:5px;
  border-width:0;
  background-color: black ;
}



```

```{r set-options, echo=FALSE, cache=FALSE}
options(width = 100)
```

```{r adding libraries,echo=FALSE, results='hide',message=FALSE}
library(ggplot2)
#(plyr)
library(ppcor)
library(tidyverse)
# library(dplyr)
# library(tidyr)
library(stringr)
library(kableExtra)
# library(data.table)
# library(network)
# library(tidygraph)
# library(ggraph)
# library(igraph)
# library(networkD3)
# library(CINNA)
# library(umap)
# library(plotly)
#library(factoextra)
#library(lsr)
# library(car)
library(ggpubr)
#library(entropy)
#library(ds4psy)
# library(pROC)
#library(devtools)
#library(BRRR)
#library(stats)
#library(afex)
library(knitr)
library(janitor)
library(car)
library(ggiraph)
library(ggiraphExtra)
library(moonBook)
library(nationalparkcolors)
library(gridExtra)
library(markdown)
```

```{r, Functions, echo=FALSE, results='hide',message=FALSE}

ReadingCSVFunc <- function(pathname){
  
   #' @description: purpose of this is to read in CSVs and clean them up 
  #' @return: DF
  
  read.csv(paste0(working_dir, pathname), header=TRUE)

}

TableOutput <- function(df){
      knitr::kable(df, row.names=F) %>% kable_styling(bootstrap_options =  c("striped", "hover", "condensed"),position = "center") %>% scroll_box(width = "600px", height = "300px")
    
  }

CleanDF <- function(DF,Variable){
  
  DF <- DF %>% select(-c("subject_id"))
  
  subinfo <- sub_info  %>% select(c("subject_id", "sex", "age_scan_years","repo_status",Variable))
  
  cleanedDF <- cbind(subinfo, DF) %>% drop_na()
  
  cleanedDF$sex[cleanedDF$sex=="Male"] <- 1 
  cleanedDF$sex[cleanedDF$sex=="Female"] <- 0
  cleanedDF$sex <- as.numeric(cleanedDF$sex)
  
    return (cleanedDF)
}


SelectAtlas <- function(Parcel,NetworkNum){
  #' @description: purpose of this is to read in and extract the ROIs from schaefer atlas you choose
  #' @return: A list of all the ROIs
  
  atlas_path <- ReadingCSVFunc(paste0("Schaefer2018_",Parcel,"Parcels_",NetworkNum, "Networks_order_FSLMNI152_1mm.Centroid_RAS.csv"))
  atlas_path$ROI.Name <- str_remove(atlas_path$ROI.Name,paste0(NetworkNum,"Networks_"))
  col_names <-c("subject_id",atlas_path$ROI.Name)
  
  return(col_names)
}

```

```{r reading in our CSVs, echo=FALSE, results='hide',message=FALSE}

working_dir <- "/Users/danielacossio/Documents/Chrastil_Lab/Projects/SNAG/Cortical_thickness/"
#working_dir <- "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/Other computers/My iMac/Chrastil_Lab/Projects/SNAG/Cortical_thickness/" # Laptop path

sub_info <- ReadingCSVFunc("subject_info.csv")%>% filter(!(subject_id %in% c("309", "341")))


CT_7network <- ReadingCSVFunc("master_CT400_parces7_networks.csv") %>% `colnames<-`(SelectAtlas(400,7)) %>%  arrange(subject_id) 

CT_17network <- ReadingCSVFunc("master_CT400_parces17_networks.csv") %>% `colnames<-`(SelectAtlas(400,17)) %>%  arrange(subject_id) 




```

<hr>

# Overview and Hypothesis 
My general hypothesis is going to be focused on general somatosensory regions and the dorsal attention network.

General approach : Do correlation between each parcellation and variable and then average by network. 

<hr>


# Degrees Traveled {.tabset .tabset-dropdown} 
## Average {.tabset .tabset-pills} 

### All 
#### 7 network  

```{r, All DT Ave 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_de_avg_degree")
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_de_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years", "sex")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"all.7net400par.aveDT.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, All DT Ave 7 network 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  
  R <- round(as.numeric(sig_corrs[sig_corrs$ROI == ROI,]['estimate']), digits =3)
  
  pval <- round(as.numeric(sig_corrs[sig_corrs$ROI == ROI,]['p.value']), digits =3)
  
  xlimit <- max(df[ROI])-0.2
  ylimit <- max(df["loop_de_avg_degree"])
  
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_de_avg_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Degree Traveled" , title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
  #   stat_cor( method = "pearson", label.x.npc = "center",
  # label.y.npc = "top")
  annotate("text", label = paste0("r=",R," ","p=",pval ), x = xlimit, y = ylimit, color="#E2929D", size=4) 
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}
grid.arrange(grobs=plist,nrow=4)
```
<br>

<br>

<hr>

<!-- #### 17 network {.tabset .tabset-pills}  -->

<!-- ```{r, All DT Ave 17 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE} -->

<!-- df <-CleanDF(CT_17network,"loop_de_avg_degree") -->
<!-- ROIs<- SelectAtlas(400,17) %>% .[-1]  -->
<!-- pcorlist <- list() -->

<!-- sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method")) -->

<!-- for (ROI in ROIs) { -->
<!--     pcorlist[[ROI]] <- pcor.test(x=df["loop_de_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years", "sex")]) -->

<!--     if (pcorlist[[ROI]][["p.value"]] < 0.05){ -->
<!--       temp <-cbind(ROI,pcorlist[[ROI]]) -->

<!--       sig_corrs <- rbind(sig_corrs,temp) -->

<!--     } -->

<!-- } -->


<!-- write.csv(sig_corrs, paste0(working_dir,"all.17net400par.aveDT.sigROIs.csv"), row.names = FALSE) -->

<!-- ``` -->

<!-- ```{r,echo=FALSE,message=FALSE} -->
<!-- TableOutput(sig_corrs) -->
<!-- ``` -->

<!-- <br> -->

<!-- ```{r, All DT Ave 17 network 400 parcs + plots, echo=FALSE, results='hide',message=FALSE} -->

<!-- ROIs<- c(sig_corrs$ROI)  # removing sibject ID -->

<!-- plist <- list() -->

<!-- for (ROI in ROIs) { -->
<!--   print(ROI) -->
<!--   plist[[ROI]] <- ggplot(df, aes(x= .data[[ROI]], y= loop_de_avg_degree))  + -->
<!--    geom_point(color="#502E23", size=4) + -->
<!--    geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) + -->
<!--     theme_classic() + -->
<!--    labs(x ="Cortical Thickness", y = "Degree Traveled", title = ROI) + -->
<!--    theme( axis.title.x = element_text(vjust = -4),  -->
<!--           plot.margin = margin(1, 1, 1, 1, "cm")) + -->
<!--    #    axis.text.x = element_text(size = 25), -->
<!--    #    axis.text.y = element_text(size = 25), -->
<!--    #    axis.title.y = element_text(vjust = 4, size = 16), -->
<!--    #    plot.title = element_text(hjust = 0.5 ,size=16), -->
<!--    #    panel.border = element_rect(fill=NA,color = "#502E23"), -->
<!--    #    panel.background =element_blank(),  -->
<!--    #    strip.text.x = element_text( -->
<!--    #      size = 16, -->
<!--    #      color = "black", -->
<!--    #      face = "bold.italic" -->
<!--    #    ), -->
<!--       # legend.position = "right")+ -->
<!--     stat_cor( method = "pearson", label.x.npc = "center", -->
<!--   label.y.npc = "top") -->
<!--       #legend.key.size = unit(2, 'cm'), -->
<!--          #legend.title = element_text(size=18), #change legend title font size -->
<!--          #legend.text = element_text(size=18), -->



<!--     #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png")) -->
<!--     #print(plist[[ROI]] ) -->
<!--     #dev.off() -->
<!-- } -->


<!-- ``` -->

<!-- ```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24} -->
<!-- grid.arrange(grobs=plist,nrow=4) -->
<!-- ``` -->
<!-- <br> -->

<!-- <hr> -->

### female 
#### 7 network
```{r, female DT Ave 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_de_avg_degree")  %>% filter(sex==0)
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_de_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"female.7net400par.aveDT.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, female DT Ave 7 network 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_de_avg_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Degree Traveled", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}

grid.arrange(grobs=plist,nrow=6)
```

<br>

<hr>

<!-- #### 17 network -->

<hr>

### Male 
#### 7 network
```{r, male DT Ave 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_de_avg_degree")  %>% filter(sex==1)
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_de_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"male.7net400par.aveDT.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, male DT Ave 7 network 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_de_avg_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Degree Traveled", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}

# plist[[1]],plist[[2]],plist[[3]], plist[[4]], plist[[5]],plist[[6]], plist[[7]], plist[[8]], plist[[9]],plist[[10]],plist[[11]],plist[[12]],plist[[13]],plist[[14]],plist[[15]],plist[[16]],plist[[17]],plist[[18]],plist[[19]],plist[[21]],plist[[22]],plist[[23]]

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=30}

grid.arrange(grobs=plist,nrow=9)
```

<br>

<hr>

<!-- #### 17 network -->

<!-- <br> -->

<!-- <hr> -->



## Radius 3 {.tabset .tabset-pills}

### All 
#### 7 network

```{r, All DT radius 3 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_de_rad3_degree")
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_de_rad3_degree"],y=df[[ROI]],z= df[,c("age_scan_years", "sex")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"all.7net400par.RAD3.DT.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, All DT radius 3 7 network 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_de_rad3_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Degree Traveled", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}
grid.arrange(grobs=plist,nrow=7)
```

<br>

<hr>

<!-- #### 17 network -->

### Female 
#### 7 network


```{r, female DT radius 3 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_de_rad3_degree") %>% filter(sex==0)
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_de_rad3_degree"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"female.7net400par.RAD3.DT.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, female DT radius 3 7 network 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_de_rad3_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Degree Traveled", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=30}
grid.arrange(grobs=plist,nrow=11)
```
<br>

<hr>

<!-- #### 17 network -->

### Male 
#### 7 network
```{r, male DT radius 3 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_de_rad3_degree") %>% filter(sex==1)
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_de_rad3_degree"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"male.7net400par.RAD3.DT.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, male DT radius 3 7 network 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_de_rad3_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Degree Traveled", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}
grid.arrange(grobs=plist,nrow=7)
```

<br>

<hr>

<!-- #### 17 network -->

<!-- <br> -->

<!-- <hr> -->

# Angular error {.tabset .tabset-dropdown} 
## Average {.tabset .tabset-pills} 
### All 

```{r, All AE Ave, echo=FALSE, results='hide',message=FALSE,fig.show='hide', warning=FALSE}

df <-CleanDF(CT_7network,"loop_ae_avg_degree")

ROIs <- SelectAtlas(400,7) %>% .[-1] # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_avg_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Position Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4,size = 16),
      axis.text.x = element_text(size = 25),
      axis.text.y = element_text(size = 25),
      axis.title.y = element_text(vjust = 4, size = 16),
      plot.title = element_text(hjust = 0.5 ,size=16),
      panel.border = element_rect(fill=NA,color = "#502E23"),
      panel.background =element_blank(), 
      strip.text.x = element_text(
        size = 16,
        color = "black",
        face = "bold.italic"
      ),
      legend.position = "right")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
      #plot.margin = margin(1, 1, 1, 1, "cm")) 


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```


Running partial correlations on our results using the 400 parcellation and 7 network. 
Out of the 400 parcellations, these are the ones that were significant. Uncorrected pvalue. 

#### 7 network 

```{r, All AE Ave 7 netowrk 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_ae_avg_degree")
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_ae_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years", "sex")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"all.7net400par.aveAE.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_avg_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Angular Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}
grid.arrange(grobs=plist,nrow=6)
```

<br>

<hr>

<!-- #### 17 network  -->

<!-- ```{r, All AE Ave 17 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE, fig.show='hide'} -->

<!-- pcorlist <- list() -->

<!-- ROIs<- SelectAtlas(400,17) %>% .[-1]  -->
<!-- cols <-  -->
<!-- sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method")) -->

<!-- df <-CleanDF(CT_17network,"loop_ae_avg_degree") -->

<!-- for (ROI in ROIs) { -->
<!--     pcorlist[[ROI]] <- pcor.test(x=df["loop_ae_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years", "sex")]) -->

<!--     if (pcorlist[[ROI]][["p.value"]] < 0.05){ -->
<!--       temp <-cbind(ROI,pcorlist[[ROI]]) -->

<!--       sig_corrs <- rbind(sig_corrs,temp) -->

<!--     } -->

<!-- } -->

<!-- write.csv(sig_corrs, paste0(working_dir,"all.17net400par.aveAE.sigROIs.csv"), row.names = FALSE) -->

<!-- ``` -->

<!-- ```{r,echo=FALSE,message=FALSE} -->
<!-- TableOutput(sig_corrs) -->
<!-- ``` -->

<!-- <br> -->

<!-- ```{r, All AE Ave 17 network 400 parcs + plots, echo=FALSE, results='hide',message=FALSE,fig.show='hide'} -->

<!-- ROIs<- c(sig_corrs$ROI)  # removing sibject ID -->

<!-- plist <- list() -->

<!-- for (ROI in ROIs) { -->
<!--   print(ROI) -->
<!--   plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_avg_degree))  + -->
<!--    geom_point(color="#502E23", size=4) + -->
<!--    geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) + -->
<!--     theme_classic() + -->
<!--    labs(x ="Cortical Thickness", y = "Angular Error", title = ROI) + -->
<!--    theme( axis.title.x = element_text(vjust = -4),  -->
<!--           plot.margin = margin(1, 1, 1, 1, "cm")) + -->
<!--    #    axis.text.x = element_text(size = 25), -->
<!--    #    axis.text.y = element_text(size = 25), -->
<!--    #    axis.title.y = element_text(vjust = 4, size = 16), -->
<!--    #    plot.title = element_text(hjust = 0.5 ,size=16), -->
<!--    #    panel.border = element_rect(fill=NA,color = "#502E23"), -->
<!--    #    panel.background =element_blank(),  -->
<!--    #    strip.text.x = element_text( -->
<!--    #      size = 16, -->
<!--    #      color = "black", -->
<!--    #      face = "bold.italic" -->
<!--    #    ), -->
<!--       # legend.position = "right")+ -->
<!--     stat_cor( method = "pearson", label.x.npc = "center", -->
<!--   label.y.npc = "top") -->
<!--       #legend.key.size = unit(2, 'cm'), -->
<!--          #legend.title = element_text(size=18), #change legend title font size -->
<!--          #legend.text = element_text(size=18), -->



<!--     #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png")) -->
<!--     #print(plist[[ROI]] ) -->
<!--     #dev.off() -->
<!-- } -->


<!-- ``` -->

<!-- ```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24} -->
<!-- grid.arrange(grobs =plist,nrow=6) -->
<!-- ``` -->
<!-- <br> -->

<!-- <hr> -->

### Female 
#### 7 network
```{r, female AE Ave 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE}

df <- CleanDF(CT_7network,"loop_ae_avg_degree") %>% filter(sex==0)

ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_ae_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}

write.csv(sig_corrs, paste0(working_dir,"female.7net400par.aveAE.sigROIs.csv"), row.names = FALSE)


```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, female AE Ave 7 network 400 parcs + plots,echo=FALSE, results='hide',message=FALSE,fig.show='hide'}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_avg_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Angular Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```



```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=30}

grid.arrange(grobs= plist,nrow=8)

```

<br>

<hr>

<!-- #### 17 network -->
<!-- ```{r, female AE Ave 17 network 400 parcs + Partial correlations with average , echo=FALSE, results='hide',message=FALSE,fig.show='hide'} -->

<!-- df <- CleanDF(CT_17network,"loop_ae_avg_degree") %>% filter(sex==0) -->

<!-- ROIs<- SelectAtlas(400,17) %>% .[-1]  -->
<!-- pcorlist <- list() -->

<!-- sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method")) -->

<!-- for (ROI in ROIs) { -->
<!--     pcorlist[[ROI]] <- pcor.test(x=df["loop_ae_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years")]) -->

<!--     if (pcorlist[[ROI]][["p.value"]] < 0.05){ -->
<!--       temp <-cbind(ROI,pcorlist[[ROI]]) -->

<!--       sig_corrs <- rbind(sig_corrs,temp) -->

<!--     } -->

<!-- } -->

<!-- write.csv(sig_corrs, paste0(working_dir,"female.17net400par.aveAE.sigROIs.csv"), row.names = FALSE) -->


<!-- ``` -->

<!-- ```{r,echo=FALSE,message=FALSE} -->
<!-- TableOutput(sig_corrs) -->
<!-- ``` -->
<!-- <br> -->

<!-- ```{r, female AE Ave 17 network 400 parcs + plots,echo=FALSE, results='hide',message=FALSE,fig.show='hide'} -->

<!-- ROIs<- c(sig_corrs$ROI)  # removing sibject ID -->

<!-- plist <- list() -->

<!-- for (ROI in ROIs) { -->
<!--   print(ROI) -->
<!--   plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_avg_degree))  + -->
<!--    geom_point(color="#502E23", size=4) + -->
<!--    geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) + -->
<!--     theme_classic() + -->
<!--    labs(x ="Cortical Thickness", y = "Angular Error", title = ROI) + -->
<!--    theme( axis.title.x = element_text(vjust = -4),  -->
<!--           plot.margin = margin(1, 1, 1, 1, "cm")) + -->
<!--    #    axis.text.x = element_text(size = 25), -->
<!--    #    axis.text.y = element_text(size = 25), -->
<!--    #    axis.title.y = element_text(vjust = 4, size = 16), -->
<!--    #    plot.title = element_text(hjust = 0.5 ,size=16), -->
<!--    #    panel.border = element_rect(fill=NA,color = "#502E23"), -->
<!--    #    panel.background =element_blank(),  -->
<!--    #    strip.text.x = element_text( -->
<!--    #      size = 16, -->
<!--    #      color = "black", -->
<!--    #      face = "bold.italic" -->
<!--    #    ), -->
<!--       # legend.position = "right")+ -->
<!--     stat_cor( method = "pearson", label.x.npc = "center", -->
<!--   label.y.npc = "top") -->
<!--       #legend.key.size = unit(2, 'cm'), -->
<!--          #legend.title = element_text(size=18), #change legend title font size -->
<!--          #legend.text = element_text(size=18), -->



<!--     #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png")) -->
<!--     #print(plist[[ROI]] ) -->
<!--     #dev.off() -->
<!-- } -->


<!-- ``` -->

<!-- ```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24} -->

<!-- grid.arrange(grobs= plist,nrow=6) -->

<!-- ``` -->
<!-- <br> -->

<!-- <hr> -->

### Male {.tabset .tabset-pills} 

#### 7 network
```{r, male AE Ave 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE}

df <- CleanDF(CT_7network,"loop_ae_avg_degree") %>% filter(sex==1)

ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_ae_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}

write.csv(sig_corrs, paste0(working_dir,"male.7net400par.aveAE.sigROIs.csv"), row.names = FALSE)


```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, male AE Ave 7 network 400 parcs + plots,echo=FALSE, results='hide',message=FALSE,fig.show='hide'}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_avg_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Angular Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```



```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}

grid.arrange(grobs= plist,nrow=7)

```
<br>

<hr>

<!-- #### 17 network -->

<!-- ```{r, male AE Ave 17 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE} -->

<!-- df <- CleanDF(CT_17network,"loop_ae_avg_degree") %>% filter(sex==1) -->

<!-- ROIs<- SelectAtlas(400,17) %>% .[-1]  -->
<!-- pcorlist <- list() -->

<!-- sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method")) -->

<!-- for (ROI in ROIs) { -->
<!--     pcorlist[[ROI]] <- pcor.test(x=df["loop_ae_avg_degree"],y=df[[ROI]],z= df[,c("age_scan_years")]) -->

<!--     if (pcorlist[[ROI]][["p.value"]] < 0.05){ -->
<!--       temp <-cbind(ROI,pcorlist[[ROI]]) -->

<!--       sig_corrs <- rbind(sig_corrs,temp) -->

<!--     } -->

<!-- } -->

<!-- write.csv(sig_corrs, paste0(working_dir,"male.17net400par.aveAE.sigROIs.csv"), row.names = FALSE) -->


<!-- ``` -->

<!-- ```{r,echo=FALSE,message=FALSE} -->
<!-- TableOutput(sig_corrs) -->
<!-- ``` -->

<!-- <br> -->

<!-- ```{r, male AE Ave 17 network 400 parcs + plots,echo=FALSE, results='hide',message=FALSE,fig.show='hide'} -->

<!-- ROIs<- c(sig_corrs$ROI)  # removing sibject ID -->

<!-- plist <- list() -->

<!-- for (ROI in ROIs) { -->
<!--   print(ROI) -->
<!--   plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_avg_degree))  + -->
<!--    geom_point(color="#502E23", size=4) + -->
<!--    geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) + -->
<!--     theme_classic() + -->
<!--    labs(x ="Cortical Thickness", y = "Angular Error", title = ROI) + -->
<!--    theme( axis.title.x = element_text(vjust = -4),  -->
<!--           plot.margin = margin(1, 1, 1, 1, "cm")) + -->
<!--    #    axis.text.x = element_text(size = 25), -->
<!--    #    axis.text.y = element_text(size = 25), -->
<!--    #    axis.title.y = element_text(vjust = 4, size = 16), -->
<!--    #    plot.title = element_text(hjust = 0.5 ,size=16), -->
<!--    #    panel.border = element_rect(fill=NA,color = "#502E23"), -->
<!--    #    panel.background =element_blank(),  -->
<!--    #    strip.text.x = element_text( -->
<!--    #      size = 16, -->
<!--    #      color = "black", -->
<!--    #      face = "bold.italic" -->
<!--    #    ), -->
<!--       # legend.position = "right")+ -->
<!--     stat_cor( method = "pearson", label.x.npc = "center", -->
<!--   label.y.npc = "top") -->
<!--       #legend.key.size = unit(2, 'cm'), -->
<!--          #legend.title = element_text(size=18), #change legend title font size -->
<!--          #legend.text = element_text(size=18), -->



<!--     #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png")) -->
<!--     #print(plist[[ROI]] ) -->
<!--     #dev.off() -->
<!-- } -->


<!-- ``` -->



<!-- ```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24} -->

<!-- grid.arrange(grobs= plist,nrow=6) -->

<!-- ``` -->

<!-- <br> -->

<!-- <hr> -->

## Radius 3 {.tabset .tabset-pills}
### All
#### 7 network

```{r, All AE radius 3 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_ae_rad3_degree")
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_ae_rad3_degree"],y=df[[ROI]],z= df[,c("age_scan_years", "sex")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"all.7net400par.RAD3.AE.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, All AE radius 3 7 network 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_rad3_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Angular Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}
grid.arrange(grobs=plist,nrow=5)
```

<br>

<hr>
<!-- #### 17 network -->

<!-- <br> -->

<!-- <hr> -->

### female 
##### 7 network
```{r, female AE radius 3 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE}

df <- CleanDF(CT_7network,"loop_ae_rad3_degree") %>% filter(sex==0)

ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_ae_rad3_degree"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}

write.csv(sig_corrs, paste0(working_dir,"female.7net400par.RAD3.AE.sigROIs.csv"), row.names = FALSE)


```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, female AE RAD  7 network 400 parcs + plots,echo=FALSE, results='hide',message=FALSE,fig.show='hide'}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_rad3_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Angular Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```



```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=30}

grid.arrange(grobs= plist,nrow=8)

```


<br>

<hr>

<!-- ##### 17 network -->
<!-- <br> -->

<!-- <hr> -->

### male 
#### 7 network
```{r, male AE radius 3 7 network 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE}

df <- CleanDF(CT_7network,"loop_ae_rad3_degree") %>% filter(sex==1)

ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_ae_rad3_degree"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}

write.csv(sig_corrs, paste0(working_dir,"male.7net400par.RAD3.AE.sigROIs.csv"), row.names = FALSE)


```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r, male AE RAD  7 network 400 parcs + plots,echo=FALSE, results='hide',message=FALSE,fig.show='hide'}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_ae_rad3_degree))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Angular Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```



```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=30}

grid.arrange(grobs= plist,nrow=8)

```

<br>

<hr>

<!-- #### 17 network -->
<!-- <br> -->

<!-- <hr> -->

# Position Error {.tabset .tabset-dropdown} 
## Average {.tabset .tabset-pills}
### All 
#### 7 network
```{r, All PE Ave 7 nework 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_pe_avg_m")
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_pe_avg_m"],y=df[[ROI]],z= df[,c("age_scan_years", "sex")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"all.7net400par.avePE.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r,  All PE Ave 7 nework 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_pe_avg_m))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Position Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=30}
grid.arrange(grobs=plist,nrow=9)
```


<br>

<hr>

<!-- #### 17 network -->
<!-- <br> -->

<!-- <hr> -->

### female 
#### 7 network

```{r, female PE Ave 7 netowrk 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_pe_avg_m") %>% filter(sex==0)
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_pe_avg_m"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"female.7net400par.avePE.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r,  female PE Ave 7 nework 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_pe_avg_m))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Position Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}
grid.arrange(grobs=plist,nrow=8)
```

<br>

<hr>

<!-- #### 17 network -->
<!-- <br> -->

<!-- <hr> -->

### male 
#### 7 network

```{r, male PE Ave 7 netowrk 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_pe_avg_m") %>% filter(sex==1)
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_pe_avg_m"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"male.7net400par.avePE.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r,  male PE Ave 7 nework 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y=loop_pe_avg_m))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Position Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}
grid.arrange(grobs=plist,nrow=8)
```

<br>

<hr>

<!-- #### 17 network -->
<!-- <br> -->

<!-- <hr> -->


## Radius 3 {.tabset .tabset-pills}
### All
#### 7 network
```{r, All PE radius 3 7 nework 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_pe_rad3_m")
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_pe_rad3_m"],y=df[[ROI]],z= df[,c("age_scan_years", "sex")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"all.7net400par.RAD3.PE.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r,  All PE radius 3 7 nework 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_pe_rad3_m))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Position Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=30}
grid.arrange(grobs=plist,nrow=9)
```

<br>

<hr>

<!-- #### 17 network -->
<!-- <br> -->

<!-- <hr> -->

### female 
#### 7 network

```{r, female PE rad3 netowrk 400 parcs + Partial correlations with average, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_pe_rad3_m") %>% filter(sex==0)
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_pe_rad3_m"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"female.7net400par.RAD3.PE.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r,  female PE radius 3 7 nework 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_pe_rad3_m))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Position Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}
grid.arrange(grobs=plist,nrow=8)
```

<br>

<hr>

<!-- #### 17 network -->
<!-- <br> -->

<!-- <hr> -->

### male 
##### 7 network

```{r, male PE rad3 netowrk 400 parcs + Partial correlations, echo=FALSE, results='hide',message=FALSE,warning=FALSE}

df <-CleanDF(CT_7network,"loop_pe_rad3_m") %>% filter(sex==1)
ROIs<- SelectAtlas(400,7) %>% .[-1] 
pcorlist <- list()

sig_corrs <-data.frame(matrix(nrow=0,ncol=7)) %>% `colnames<-`(c("roi", "estimate" ,"p.value","statistic","n","gp","Method"))

for (ROI in ROIs) {
    pcorlist[[ROI]] <- pcor.test(x=df["loop_pe_rad3_m"],y=df[[ROI]],z= df[,c("age_scan_years")])
    
    if (pcorlist[[ROI]][["p.value"]] < 0.05){
      temp <-cbind(ROI,pcorlist[[ROI]])
      
      sig_corrs <- rbind(sig_corrs,temp)
      
    }
  
}


write.csv(sig_corrs, paste0(working_dir,"male.7net400par.RAD3.PE.sigROIs.csv"), row.names = FALSE)

```

```{r,echo=FALSE,message=FALSE}
TableOutput(sig_corrs)
```

<br>

```{r,  male PE radius 3 7 nework 400 parcs + plots, echo=FALSE, results='hide',message=FALSE}

ROIs<- c(sig_corrs$ROI)  # removing sibject ID

plist <- list()

for (ROI in ROIs) {
  print(ROI)
  plist[[ROI]] <- ggplot(df, aes(x=.data[[ROI]], y= loop_pe_rad3_m))  +
   geom_point(color="#502E23", size=4) +
   geom_smooth(method="lm", level=0.95,color ="#E2929D", se=FALSE,linewidth=2) +
    theme_classic() +
   labs(x ="Cortical Thickness", y = "Position Error", title = ROI) +
   theme( axis.title.x = element_text(vjust = -4), 
          plot.margin = margin(1, 1, 1, 1, "cm")) +
   #    axis.text.x = element_text(size = 25),
   #    axis.text.y = element_text(size = 25),
   #    axis.title.y = element_text(vjust = 4, size = 16),
   #    plot.title = element_text(hjust = 0.5 ,size=16),
   #    panel.border = element_rect(fill=NA,color = "#502E23"),
   #    panel.background =element_blank(), 
   #    strip.text.x = element_text(
   #      size = 16,
   #      color = "black",
   #      face = "bold.italic"
   #    ),
      # legend.position = "right")+
    stat_cor( method = "pearson", label.x.npc = "center",
  label.y.npc = "top")
      #legend.key.size = unit(2, 'cm'),
         #legend.title = element_text(size=18), #change legend title font size
         #legend.text = element_text(size=18),
     


    #png(file = CleanCSVsfigpath,ROI,"_sexdiff_QA.png"))  #,".png"))
    #print(plist[[ROI]] )
    #dev.off()
}


```

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.width=16, fig.height=24}
grid.arrange(grobs=plist,nrow=4)
```

<br>

<hr>

<!-- ##### 17 network -->
<!-- <br> -->

<!-- <hr> -->


# ROIs


