---
title: "All Results"
author: "Daniela Cossio"
date: "10/17/2023"
output:
   html_document:
    toc: true
    toc_float: true
    toc_depth: 6
    theme: flatly
editor_options: 
  chunk_output_type: inline
---

```{css, echo=FALSE}
h1, h2, h3, h4, h5 ,h6 {
  text-align: center;
  font-family: Times;
  
}

h1, h2 {
background-color: LavenderBlush;
  font-weight: bold;
}

body, p {
  color: black; 
  font-family: Times;
}


```

```{r adding libraries,echo=FALSE, results='hide',message=FALSE}
library(ggplot2)
#(plyr)
library(tidyverse)
# library(dplyr)
# library(tidyr)
library(stringr)
library(kableExtra)
# library(data.table)
# library(network)
# library(tidygraph)
# library(ggraph)
# library(igraph)
# library(networkD3)
# library(CINNA)
# library(umap)
# library(plotly)
#library(factoextra)
#library(lsr)
# library(car)
library(ggpubr)
#library(entropy)
#library(ds4psy)
# library(pROC)
#library(devtools)
#library(BRRR)
#library(stats)
#library(afex)
library(knitr)
library(janitor)
library(car)
library(ggiraph)
library(ggiraphExtra)
library(moonBook)
library(nationalparkcolors)
library(gridExtra)
library(markdown)
```

```{r reading in our CSVs, echo=FALSE, results='hide',message=FALSE}
working_dir <- "/Users/danielacossio/Documents/Chrastil_Lab/Projects/SNAG/DSI_rerun_data/"

# PE_working_dir <- "/Users/danielacossio/Library/CloudStorage/GoogleDrive-dcossio1@uci.edu/My Drive/White matter tract/MidlifeWM_DSI2023/DSI/maze/Path_eff/"

rows2grab <- c("Tract Name", "number of tracts","mean length(mm)","diameter(mm)", "volume(mm^3)")


sub_info <- read.csv("/Users/danielacossio/Documents/Chrastil_Lab/Projects/SNAG/DSI_rerun_data/subject_info.csv")
```

```{r functions, echo=FALSE, results='hide',message=FALSE}

ReadingCSVFunc <- function(pathname){
  
  read.delim(paste0(working_dir, pathname), header=FALSE,sep = "\t")
  
}

CleanInput <- function(DF){
  

  DF <- DF %>% 
      remove_empty("cols") %>% 
        filter(V1 %in% rows2grab) %>% 
          t() %>% 
            `colnames<-`(rows2grab) %>% 
                `[`(-c(1),) %>% 
                    as.data.frame()
  return(DF)
}


Extract_raw_values <- function(DF,Metric) {
  # Purpose of this function is to clean the data without me having to copy and paste everything later. 
  
  # Data = raw unclean dataframe we want to clean up 
  # Metric will be either MD or QA
  # sex is either male or female
 
  
  # Let's read in our data frame 
  
  # grab  ROIcolumn names 
  colNames <- DF  %>% remove_empty("cols") %>%
  filter(V1 == "Tract Name") %>% t() %>% `[`(-1) 
  
  
  subinfo <- sub_info  %>% select(c("subject_id", "sex", "age_scan_years", "maze_accuracy_pct")) 
 
  # Let's grab our values 
  if (Metric == "MD"){
    Values <- DF %>% remove_empty("cols") %>% 
     filter(str_detect(V1, c("mean_md"))) %>%
   `colnames<-`(c("Subjects",colNames)) 
  }
  else{
    Values <- DF %>%
     remove_empty("cols") %>%
      filter(str_detect(V1, c("mean_qa"))) %>% 
  `colnames<-`(c("Subjects",colNames)) %>% filter(!str_detect(Subjects, c("sub-369"))) 

  }
  
  # now let's put this together 
  ConvToNum <-  apply(Values[,2:length(Values)],2, as.numeric)
  Values[,2:length(Values)] <- ConvToNum
  
  cleanedDF <- cbind(subinfo,Values) %>% na.omit() %>% select(-c("Subjects"))
  
  return (cleanedDF)
}


TableOutput <- function(df, style, width, height, caption){
  
  if (style == "classic"){
      knitr::kable(df, row.names=F, caption = caption) %>% kable_classic(full_width = F, html_font = "Cambria")
    
  } else {
      knitr::kable(df, row.names=F) %>% kable_styling(bootstrap_options =  c("striped", "hover", "condensed")) %>% scroll_box(width = paste0(width,"px"), height = paste0(height,"px")) 
    
  }

}

```
# Overview 
This is the analysis of white matter dsi studio connectometry for Maze and Loop 

# <span style="color: darkblue;">Methods </span>  {.tabset .tabset-pills} 

## **Participants** 

  * Total number of scans = 120 (males and females)  
  
  * Total scans used in analysis= 118  
  * Excluded subs 329 and 372 from analyses due to bad behavior data and Subject 347 failed quality 
  control check in DSI
   * Several subjects removed because they did not have rad3 score  
<br><br><br><br><br>

## **Maze Accuracy and Path Efficiency**

  * All subjects = 82
  * Men = 22
  * Women = 60
  * Stage
  * Pre = 23
  * Peri = 20 
  * Post = 17
<br><br><br><br><br>
 
  
## **Scan parameters** 

  * Locations from UCSB and UCI
<br><br><br><br><br>

## **QSIprep** 

  * Version used: 0.16.0RC3

  * The following parameters were used
    * dwi_denoise_window **5** 
    * hmc_model **3dSHORE** 
    * hmc-transform **Rigid** 
    * shoreline_iters **2**
<br><br><br><br><br>

## **DSI Studio**

  * Version and tags used via singularity container: **chen-2022-07-31**
  
  * **Parameters** 
    * T-threshold = 2.5
    * Length = 25
    * Permutation = 4,000
    * pruning 4
    * non normalized QA

<br><br><br><br><br>


## **Connectronomy analysis methods write up**
<br>

A diffusion spectrum imaging scheme was used, and a total of 128 diffusion sampling were acquired.  
The maximum b-value was 4990 s/mm². The in-plane resolution was 1.8 mm. The slice thickness wasc1.8 mm. The accuracy of b-table orientation was examined by comparing fiber orientations with those of a population-averaged template (Yeh et al. Neuroimage, 2018). The b-table was flipped by 
The diffusion data were reconstructed in the MNI space using q-space diffeomorphic reconstruction
(Yeh et al., Neuroimage, 58(1):91-9, 2011) to obtain the spin distribution function (Yeh et al., IEEE TMI, ;29(9):1626-35, 2010).  A diffusion sampling length ratio of 1.25 was used. The output resolution in diffeomorphic reconstruction was 1.8 mm isotropic. The tensor metrics were calculated using DWI with b-value lower than 1750 s/mm². The quantitative anisotropy was extracted as the local connectome fingerprint (LCF, Yeh et al. PLoS Comput Biol 12(11): e1005203) and used in the connectometry analysis.</p>
<br>

Diffusion MRI connectometry (Yeh et al. NeuroImage 125 (2016): 162-171) was used to derive the correlational tractography that has QA, MD, AD, and RD correlated with Maze Accuracy and path efficiency. A nonparametric Spearman partial correlation was used to derive the correlation, and the effect of sex, age_scan_years, and repo_status was removed using a multiple regression model. The total number of subjects varied on analysis (See Analyses and Final sample sizes above). A T-score threshold of 2.5 was assigned and tracked using a deterministic fiber tracking algorithm (Yeh et al. PLoS ONE 8(11): e80713, 2013) to obtain correlational tractography. A seeding region was placed at whole brain (39,49,29) .
<br>

 The tracks were filtered by topology-informed pruning (Yeh et al. Neurotherapeutics, 16(1), 52-58, 2019) with 4 iteration(s). A length threshold of 25 voxel distance was used to select tracks. To estimate the false discovery rate, a total of 4000 randomized permutations were applied to the group label to obtain the null distribution of the track length.</p>

<br><br><br><br><br><br>

# <span style="color: darkorange;"> Results </span>  {.tabset .tabset-dropdown}  

## <span style="color: darkorange;"> **Maze Accuracy** </span>  {.tabset .tabset-pills} 

### Summary 

Broadly, QA is positively associated with maze accuracy. Better QA in tracts (associated with motor, cingulum) is associated with better maze accuracy score. This relationship is similar in men and women. Interestingly, in a previous run, men showed more negative correlations but in this run there are only positive association  when controlling for FNAME performance.

### QA {.tabset .tabset-pills}

#### All subjects 

In this analysis we have included all subjects while controlling for age, and sex. WE used a normalized QA. The results suggest that ...

<p style="text-align:center ; font-size: 24px" > <strong>Control for FNAME</strong> </p>


We decided to control for general memory changes by using performance on the FNAME task as a covariate. Here we see that QA is positively associated with  maze performance in midlife adults (Table 1; FDR=0.00381). 

```{r, echo=FALSE,message=FALSE}
all_QA <- CleanInput(ReadingCSVFunc("maze_acc/QA/fname_covariate/QA_positive_mazeacc_all_fname.csv"))

TableOutput(all_QA, "classic", 500, 200," Table 1.Tracts with QA positively associated with maze accuracy")
```

<br>

<p style="text-align:center ; font-size: 24px" > <strong>previous run results</strong> </p>

<span style="color: MediumOrchid;font-size: 18px;background-color: Snow"> <strong>Positive (FDR = 0.043228)</strong> </span>
```{r,echo=FALSE,message=FALSE}
all_QA1 <- CleanInput(ReadingCSVFunc("maze_acc/QA/noFNAME/QA_all_pos.csv"))

TableOutput(all_QA1, "classic", 500, 200, " Table 2.Tracts with QA positively associated with maze accuracy in midlife adults")
```


<span style="color: LightSeaGreen;font-size: 18px;background-color: Snow"> <strong>Negative  (FDR = 0.122807)</strong> </span>
```{r,echo=FALSE,message=FALSE}
all_QA_neg1 <- CleanInput(ReadingCSVFunc("maze_acc/QA/noFNAME/QA_all_neg.csv"))

TableOutput(all_QA_neg1, "classic", 500, 200, " Table 2.Tracts with QA negatively associated with maze accuracy in midlife adults")
```

<br><br><br>

#### females

<p style="text-align:center ; font-size: 24px" > <strong>Control for FNAME</strong> </p>

<span style="color: MediumOrchid;font-size: 18px;background-color: Snow"> <strong>Positively FDR= 0.000571</strong> </span>
```{r,echo=FALSE,message=FALSE}
females_QA <- CleanInput(ReadingCSVFunc("maze_acc/QA/fname_covariate/female.mazelearningacc.pos.csv"))

TableOutput(females_QA, "classic", 500, 200, " Table 2.Tracts with QA positively associated with maze accuracy in female midlife adults")
```

<br>

<p style="text-align:center ; font-size: 24px" > <strong>previous run results</strong> </p>
<br><br>

<span style="color: MediumOrchid;font-size: 18px;background-color: Snow"> <strong>Positively FDR= 0.000263</strong> </span>
```{r,echo=FALSE,message=FALSE}
females_Q1 <- CleanInput(ReadingCSVFunc("maze_acc/QA/noFNAME/QA_female_pos.csv"))

TableOutput(females_Q1, "classic", 500, 200, " Table 2.Tracts with QA positively associated with maze accuracy in female midlife adults")
```

<br><br>

<span style="color: LightSeaGreen;font-size: 18px;background-color: Snow">Negatively FDR= 0.002809</strong> </span>
```{r,echo=FALSE,message=FALSE}
females_QA2 <- CleanInput(ReadingCSVFunc("maze_acc/QA/noFNAME/QA_female-neg.csv"))

TableOutput(females_QA2, "classic", 500, 200, " Table 2.Tracts with QA negatively associated with maze accuracy in female midlife adults")
```

<br><br><br>

#### Males 
<p style="text-align:center ; font-size: 24px" > <strong>Control for FNAME</strong> </p>
<br><br>

<span style="color: MediumOrchid;font-size: 18px;background-color: Snow"><strong> Positively FDR= 0.000042</strong> </span>
```{r,echo=FALSE,message=FALSE}
males_QA <- CleanInput(ReadingCSVFunc("maze_acc/QA/fname_covariate/male.mazelearning.acc.pos.csv"))

TableOutput(males_QA, "classic", 500, 200, " Table 2.Tracts with QA positively associated with maze accuracy in male midlife adults")
```
<br><br><br><br>

<p style="text-align:center ; font-size: 24px" > <strong>previous run results</strong> </p>
<br>

<span style="color: MediumOrchid;font-size: 18px;background-color: Snow"><strong> Positive (FDR = 0.018519)</strong> </span>
```{r, echo=FALSE,message=FALSE}
males_QA1 <- CleanInput(ReadingCSVFunc("maze_acc/QA/noFNAME/QA_male_pos.csv"))

TableOutput(males_QA1, "classic", 500, 200," Table 1.Tracts with QA positively associatated with maze accuracy")
```

<br><br>

<span style="color: LightSeaGreen;font-size: 18px;background-color: Snow"><strong>Negative (FDR = 0.001161)</strong> </span>
```{r, echo=FALSE,message=FALSE}
males_QA2 <- CleanInput(ReadingCSVFunc("maze_acc/QA/noFNAME/QA_male_neg.csv"))

TableOutput(males_QA2, "classic", 500, 200," Table 1.Tracts with QA negatively associatated with maze accuracy")
```

<br><br><br>




### MD {.tabset}


## <span style="color: darkorange;"> **Position Error** </span>  {.tabset .tabset-dropdown} 

### Rad3 {.tabset .tabset-pills}
#### Summary
Increased QA in many tracts outside of the limbic area are associated with a lower position error.

#### QA {.tabset .tabset-pills}
##### All subject
<p style="text-align:center ; font-size: 24px" > <strong>Control for FNAME</strong> </p>

<span style="color: LightSeaGreen;font-size: 18px;background-color: Snow"> <strong>Negative  (FDR = 0.000407)</strong> </span>
```{r, echo=FALSE,message=FALSE}
loopPE_QA_all<- CleanInput(ReadingCSVFunc("Loop/QA/PE/fname_cov/all.loopPE.average.neg.csv"))

TableOutput(loopPE_QA_all, "classic", 500, 200," Table 1.Tracts with QA positively associated with loop PE")
```

<br>

<p style="text-align:center ; font-size: 24px" > <strong>previous run results</strong> </p>

<span style="color: MediumOrchid;font-size: 18px;background-color: Snow"> <strong>Positive (FDR = 0.000547)</strong> </span>
```{r,echo=FALSE,message=FALSE}
loopPE_QA_all1 <- CleanInput(ReadingCSVFunc("Loop/QA/PE/noFNAME/QA_loopAvgPE_allsubs_pos.csv"))

TableOutput(loopPE_QA_all1, "classic", 500, 200, "Table 1.Tracts with QA positively associated with loop PE")
```


<span style="color: LightSeaGreen;font-size: 18px;background-color: Snow"> <strong>Negative  (FDR = 0.015697)</strong> </span>
```{r,echo=FALSE,message=FALSE}
loopPE_QA_all2 <- CleanInput(ReadingCSVFunc("Loop/QA/PE/noFNAME/QA_loopAvgPE_allsubs_neg.csv"))

TableOutput(loopPE_QA_all2, "classic", 500, 200, " Table 2.Tracts with QA negatively associated with loop PE")
```

<br><br><br>

##### Females

<p style="text-align:center ; font-size: 24px" > <strong>Control for FNAME</strong> </p>

<p style="text-align:center ; font-size: 24px" > <strong>previous run results</strong> </p>

##### Males

#### MD {.tabset .tabset-pills}
##### All subject
##### Females
##### Males
### Average {.tabset .tabset-pills}
#### QA {.tabset .tabset-pills}
##### All subject
##### Females
##### Males

#### MD{.tabset .tabset-pills}
##### All subject
##### Females
##### Males

## <span style="color: darkorange;"> DEgrees Traveled </span>  {.tabset .tabset-pills} 
### QA {.tabset .tabset-pills}
#### All subject
#### Females
#### Males

### MD {.tabset .tabset-pills}
#### All subject
#### Females
#### Males


## <span style="color: darkorange;"> DSP </span>  {.tabset .tabset-pills} 
### QA {.tabset .tabset-pills}
#### All subject
#### Females
#### Males
### MD{.tabset .tabset-pills}
#### All subject
#### Females
#### Males